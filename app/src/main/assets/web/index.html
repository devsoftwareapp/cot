<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>PDF Reader | Dev Software</title>
  
  <style>
    /* Material Symbols - Optimized for WebView */
    .material-symbols-rounded {
      font-family: 'Material Symbols Rounded';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
    }
    
    /* --- BASIC STYLES --- */
    :root {
      --background: #e8e8e8;
      --surface: #e8e8e8;
      --primary: #E53935;
      --secondary: #B71C1C;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --border: #d4d4d4; 
      --shadow-md: 0 2px 4px rgba(0,0,0,0.1);
      
      --header-height: 56px;
      --tabs-height: 48px;
      --bottom-nav-height: 56px;
    }

    [data-theme="dark"] {
      --background: #0f172a;
      --surface: #1e293b;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --border: #334155;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { 
      height: 100%; 
      font-family: 'Roboto', sans-serif; 
      background-color: var(--background); 
      color: var(--text-primary); 
      overflow: hidden; 
    }
    
    body { 
      display: flex; 
      flex-direction: column; 
    }

    /* --- TOP BAR --- */
    .top-bar {
      height: var(--header-height);
      background: var(--surface);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-bottom: 1px solid var(--border);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }
    
    .logo-title {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .app-title {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(to right, #B71C1C, #FF6961);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      color: var(--text-secondary);
    }
    
    .icon-btn:active {
      background: rgba(0,0,0,0.1);
    }
    
    /* --- TABS --- */
    .tabs-container {
      height: var(--tabs-height);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      z-index: 99;
    }
    
    .tab {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      font-size: 11px;
      gap: 2px;
    }
    
    .tab.active {
      color: var(--primary);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 25%;
      right: 25%;
      height: 3px;
      background: var(--primary);
      border-radius: 3px 3px 0 0;
    }
    
    /* --- MAIN CONTENT --- */
    .main-content {
      flex: 1;
      margin-top: calc(var(--header-height) + var(--tabs-height));
      margin-bottom: var(--bottom-nav-height);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .content-panel {
      display: none;
      padding: 16px;
    }
    
    .content-panel.active {
      display: block;
    }
    
    /* --- PDF CARDS --- */
    .pdf-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .pdf-card {
      background: var(--surface);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid var(--border);
    }
    
    .pdf-card:active {
      background: rgba(0,0,0,0.05);
      transform: scale(0.98);
    }
    
    .pdf-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: #E53935;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
    
    .pdf-info {
      flex: 1;
    }
    
    .pdf-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    
    .pdf-meta {
      font-size: 11px;
      color: var(--text-secondary);
    }
    
    .pdf-actions {
      display: flex;
      gap: 4px;
    }
    
    /* --- BOTTOM NAV --- */
    .bottom-nav {
      height: var(--bottom-nav-height);
      background: var(--surface);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px;
      color: var(--text-secondary);
      font-size: 11px;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    /* --- FAB --- */
    .fab-container {
      position: fixed;
      bottom: calc(var(--bottom-nav-height) + 16px);
      right: 16px;
      z-index: 101;
    }
    
    .fab {
      width: 56px;
      height: 56px;
      border-radius: 28px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    /* --- EMPTY STATE --- */
    .empty-state {
      padding: 40px 20px;
      text-align: center;
      color: var(--text-secondary);
    }
    
    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* --- SELECTION MODE --- */
    body.selection-mode .pdf-card {
      padding-left: 40px;
      position: relative;
    }
    
    .selection-checkbox {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      border: 2px solid var(--text-secondary);
      border-radius: 4px;
    }
    
    .selection-checkbox.selected {
      background: var(--primary);
      border-color: var(--primary);
    }
    
    .selection-checkbox.selected::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: bold;
    }
    
    .selection-header {
      display: none;
    }
    
    body.selection-mode .selection-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      flex: 1;
    }
    
    body.selection-mode .normal-header {
      display: none;
    }
    
    .selection-count {
      font-size: 14px;
      font-weight: 500;
    }
    
    .selection-actions {
      display: flex;
      gap: 4px;
    }
    
    /* --- MENU --- */
    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
    }
    
    .menu-overlay.show {
      display: block;
    }
    
    .menu-sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 280px;
      background: var(--surface);
      transform: translateX(-100%);
      transition: transform 0.3s;
      z-index: 1001;
      overflow-y: auto;
    }
    
    .menu-sidebar.open {
      transform: translateX(0);
    }
    
    .menu-header {
      padding: 24px 16px;
      border-bottom: 2px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .menu-content {
      padding: 16px;
    }
    
    .menu-item {
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-radius: 8px;
      margin-bottom: 4px;
    }
    
    .menu-item:active {
      background: rgba(0,0,0,0.1);
    }
    
    /* --- CONTEXT MENU --- */
    .context-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
    }
    
    .context-overlay.show {
      display: block;
    }
    
    .context-sheet {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-radius: 16px 16px 0 0;
      padding: 16px 0;
      transform: translateY(100%);
      transition: transform 0.3s;
      z-index: 1001;
    }
    
    .context-sheet.show {
      transform: translateY(0);
    }
    
    .sheet-item {
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .sheet-item:active {
      background: rgba(0,0,0,0.1);
    }
    
    .sheet-item.danger {
      color: #f44336;
    }
    
  </style>
</head>
<body>

  <input type="file" id="fileInput" accept="application/pdf" style="display: none;">

  <div class="top-bar">
    <div class="normal-header" style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
      <div class="logo-title">
        <div class="logo">
          <img src="file:///android_asset/web/logo/logo.png" alt="Logo">
        </div>
        <h1 class="app-title">PDF Reader</h1>
      </div>
      <div>
        <button class="icon-btn" id="menuBtn">
          <span class="material-symbols-rounded">menu</span>
        </button>
      </div>
    </div>
    
    <div class="selection-header">
      <div class="selection-count" id="selectionCount">0 selected</div>
      <div class="selection-actions">
        <button class="icon-btn" onclick="selectAll()">
          <span class="material-symbols-rounded">select_all</span>
        </button>
        <button class="icon-btn" onclick="shareSelected()">
          <span class="material-symbols-rounded">share</span>
        </button>
        <button class="icon-btn" onclick="deleteSelected()">
          <span class="material-symbols-rounded">delete</span>
        </button>
        <button class="icon-btn" onclick="exitSelection()">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
    </div>
  </div>

  <div class="tabs-container">
    <div class="tab active" data-tab="recent">
      <span class="material-symbols-rounded">history</span>
      <span>Recent</span>
    </div>
    <div class="tab" data-tab="device">
      <span class="material-symbols-rounded">folder</span>
      <span>Device</span>
    </div>
    <div class="tab" data-tab="favorites">
      <span class="material-symbols-rounded">star</span>
      <span>Favorites</span>
    </div>
  </div>

  <main class="main-content">
    <div class="content-panel active" id="recentPanel">
      <div class="pdf-grid" id="recentList">
        </div>
    </div>
    
    <div class="content-panel" id="devicePanel">
      <div class="pdf-grid" id="deviceList">
        </div>
    </div>
    
    <div class="content-panel" id="favoritesPanel">
      <div class="pdf-grid" id="favoritesList">
        </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <div class="nav-item active" data-nav="home">
      <span class="material-symbols-rounded">home</span>
      <span>Home</span>
    </div>
    <div class="nav-item" data-nav="tools">
      <span class="material-symbols-rounded">build</span>
      <span>Tools</span>
    </div>
    <div class="nav-item" data-nav="files">
      <span class="material-symbols-rounded">folder</span>
      <span>Files</span>
    </div>
  </nav>

  <div class="fab-container">
    <button class="fab" id="fabBtn">
      <span class="material-symbols-rounded">add</span>
    </button>
  </div>

  <div class="menu-overlay" id="menuOverlay"></div>
  <div class="menu-sidebar" id="menuSidebar">
    <div class="menu-header">
      <div class="logo">
        <img src="file:///android_asset/web/logo/logo.png" alt="Logo">
      </div>
      <h2 style="font-size: 20px; font-weight: 700; color: var(--primary);">PDF Reader</h2>
    </div>
    <div class="menu-content">
      <div class="menu-item" onclick="openSettings()">
        <span class="material-symbols-rounded">settings</span>
        <span>Settings</span>
      </div>
      <div class="menu-item" onclick="openHelp()">
        <span class="material-symbols-rounded">help</span>
        <span>Help</span>
      </div>
      <div class="menu-item" onclick="openAbout()">
        <span class="material-symbols-rounded">info</span>
        <span>About</span>
      </div>
    </div>
  </div>

  <div class="context-overlay" id="contextOverlay"></div>
  <div class="context-sheet" id="contextSheet">
    <div class="sheet-item" onclick="renamePdf()">
      <span class="material-symbols-rounded">edit</span>
      <span>Rename</span>
    </div>
    <div class="sheet-item" onclick="sharePdf()">
      <span class="material-symbols-rounded">share</span>
      <span>Share</span>
    </div>
    <div class="sheet-item" onclick="printPdf()">
      <span class="material-symbols-rounded">print</span>
      <span>Print</span>
    </div>
    <div class="sheet-item danger" onclick="deletePdf()">
      <span class="material-symbols-rounded">delete</span>
      <span>Delete</span>
    </div>
  </div>

  <script>
    // --- VARIABLES ---
    let currentTab = 'recent';
    let currentNav = 'home';
    let isSelectionMode = false;
    let selectedFiles = new Set();
    let pdfs = [];
    let currentContextPdf = null;

    // --- ANDROID BRIDGE FUNCTIONS ---
    function androidCheckPermission() {
        if (typeof Android !== 'undefined' && Android.checkPermission) {
            return Android.checkPermission();
        }
        return false;
    }
    
    function androidListPDFs() {
        if (typeof Android !== 'undefined' && Android.listPDFs) {
            return Android.listPDFs();
        }
        return "";
    }
    
    function androidOpenPDF(path) {
        if (typeof Android !== 'undefined' && Android.openPDF) {
            Android.openPDF(path);
        }
    }
    
    function androidSharePDF(path) {
        if (typeof Android !== 'undefined' && Android.sharePDF) {
            Android.sharePDF(path);
        }
    }
    
    function androidDeletePDF(path) {
        if (typeof Android !== 'undefined' && Android.deletePDF) {
            return Android.deletePDF(path);
        }
        return false;
    }
    
    function androidShowToast(message) {
        if (typeof Android !== 'undefined' && Android.showToast) {
            Android.showToast(message);
        } else {
            alert(message);
        }
    }

    // --- APP INIT ---
    document.addEventListener('DOMContentLoaded', function() {
        loadTheme();
        setupEventListeners();
        loadPDFs();
    });

    // --- THEME MANAGEMENT ---
    function loadTheme() {
        const savedTheme = localStorage.getItem('pdfTheme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    }

    function setTheme(theme) {
        localStorage.setItem('pdfTheme', theme);
        document.documentElement.setAttribute('data-theme', theme);
    }

    // --- EVENT LISTENERS ---
    function setupEventListeners() {
        // Tab clicks
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });
        
        // Nav clicks
        document.querySelectorAll('.nav-item').forEach(nav => {
            nav.addEventListener('click', function() {
                switchNav(this.dataset.nav);
            });
        });
        
        // Menu button
        document.getElementById('menuBtn').addEventListener('click', openMenu);
        
        // Menu overlay
        document.getElementById('menuOverlay').addEventListener('click', closeMenu);
        
        // Context overlay
        document.getElementById('contextOverlay').addEventListener('click', closeContext);
        
        // FAB button
        document.getElementById('fabBtn').addEventListener('click', openFabMenu);
        
        // File input
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
    }

    // --- TAB MANAGEMENT ---
    function switchTab(tabId) {
        currentTab = tabId;
        
        // Tab display
        document.querySelectorAll('.tab').forEach(t => {
            t.classList.toggle('active', t.dataset.tab === tabId);
        });
        
        // Panel display
        document.querySelectorAll('.content-panel').forEach(p => {
            p.classList.toggle('active', p.id === tabId + 'Panel');
        });
        
        // Load PDFs
        loadPDFs();
    }

    // --- NAV MANAGEMENT ---
    function switchNav(navId) {
        currentNav = navId;
        
        // Nav display
        document.querySelectorAll('.nav-item').forEach(n => {
            n.classList.toggle('active', n.dataset.nav === navId);
        });
        
        // Show/Hide FAB
        document.getElementById('fabBtn').style.display = 
            (navId === 'home') ? 'flex' : 'none';
    }

    // --- LOAD PDFs ---
    function loadPDFs() {
        let files = [];
        
        if (currentTab === 'device') {
            // Get PDF list from Android
            if (androidCheckPermission()) {
                const pdfList = androidListPDFs();
                if (pdfList) {
                    files = pdfList.split('||').map(path => {
                        const name = path.split('/').pop();
                        return {
                            id: Date.now() + Math.random(),
                            name: name,
                            path: path,
                            isFavorite: false,
                            size: '2.5 MB',
                            date: new Date().toLocaleDateString('en-US')
                        };
                    });
                }
            }
        } else if (currentTab === 'favorites') {
            // Favorites
            files = pdfs.filter(pdf => pdf.isFavorite);
        } else {
            // Recent
            files = pdfs.slice(0, 10); // Last 10 PDFs
        }
        
        renderPDFList(files);
    }

    // --- RENDER PDF LIST ---
    function renderPDFList(files) {
        const containerId = currentTab + 'List';
        const container = document.getElementById(containerId);
        
        if (!files || files.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="material-symbols-rounded empty-icon">folder_open</div>
                    <p>No PDF files yet</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        files.forEach(pdf => {
            html += `
                <div class="pdf-card" 
                     data-id="${pdf.id}"
                     onclick="handlePdfClick('${pdf.id}')"
                     oncontextmenu="event.preventDefault(); openContextMenu('${pdf.id}')">
                    ${isSelectionMode ? `
                    <div class="selection-checkbox ${selectedFiles.has(pdf.id) ? 'selected' : ''}" 
                         onclick="event.stopPropagation(); toggleSelection('${pdf.id}')"></div>
                    ` : ''}
                    <div class="pdf-icon">PDF</div>
                    <div class="pdf-info">
                        <div class="pdf-name">${pdf.name}</div>
                        <div class="pdf-meta">${pdf.size} • ${pdf.date}</div>
                    </div>
                    <div class="pdf-actions">
                        <button class="icon-btn" onclick="event.stopPropagation(); toggleFavorite('${pdf.id}')">
                            <span class="material-symbols-rounded" style="font-variation-settings: 'FILL' ${pdf.isFavorite ? 1 : 0}">
                                star
                            </span>
                        </button>
                        <button class="icon-btn" onclick="event.stopPropagation(); openContextMenu('${pdf.id}')">
                            <span class="material-symbols-rounded">more_vert</span>
                        </button>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }

    // --- PDF CLICK ---
    function handlePdfClick(pdfId) {
        if (isSelectionMode) {
            toggleSelection(pdfId);
            return;
        }
        
        const pdf = pdfs.find(p => p.id == pdfId);
        if (pdf && pdf.path) {
            androidOpenPDF(pdf.path);
        }
    }

    // --- FAVORITE ACTIONS ---
    function toggleFavorite(pdfId) {
        const pdf = pdfs.find(p => p.id == pdfId);
        if (pdf) {
            pdf.isFavorite = !pdf.isFavorite;
            androidShowToast(pdf.isFavorite ? 'Added to favorites' : 'Removed from favorites');
            loadPDFs();
        }
    }

    // --- SELECTION MODE ---
    function toggleSelection(pdfId) {
        if (!isSelectionMode) {
            enterSelectionMode();
        }
        
        if (selectedFiles.has(pdfId)) {
            selectedFiles.delete(pdfId);
        } else {
            selectedFiles.add(pdfId);
        }
        
        updateSelectionUI();
        
        if (selectedFiles.size === 0) {
            exitSelection();
        }
    }
    
    function enterSelectionMode() {
        isSelectionMode = true;
        document.body.classList.add('selection-mode');
        updateSelectionUI();
    }
    
    function exitSelection() {
        isSelectionMode = false;
        selectedFiles.clear();
        document.body.classList.remove('selection-mode');
        updateSelectionUI();
    }
    
    function selectAll() {
        const currentPdfs = getCurrentPDFs();
        currentPdfs.forEach(pdf => selectedFiles.add(pdf.id));
        updateSelectionUI();
    }
    
    function shareSelected() {
        if (selectedFiles.size === 0) return;
        
        const pdfsToShare = getCurrentPDFs().filter(pdf => selectedFiles.has(pdf.id));
        pdfsToShare.forEach(pdf => {
            if (pdf.path) {
                androidSharePDF(pdf.path);
            }
        });
        
        exitSelection();
    }
    
    function deleteSelected() {
        if (selectedFiles.size === 0) return;
        
        if (!confirm(`${selectedFiles.size} PDF(s) will be deleted. Are you sure?`)) return;
        
        const pdfsToDelete = getCurrentPDFs().filter(pdf => selectedFiles.has(pdf.id));
        let successCount = 0;
        
        pdfsToDelete.forEach(pdf => {
            if (pdf.path && androidDeletePDF(pdf.path)) {
                successCount++;
                pdfs = pdfs.filter(p => p.id !== pdf.id);
            }
        });
        
        androidShowToast(`${successCount} PDF(s) deleted`);
        exitSelection();
        loadPDFs();
    }
    
    function updateSelectionUI() {
        document.getElementById('selectionCount').textContent = 
            `${selectedFiles.size} selected`;
        
        // Update checkboxes
        document.querySelectorAll('.pdf-card').forEach(card => {
            const pdfId = card.dataset.id;
            const checkbox = card.querySelector('.selection-checkbox');
            if (checkbox) {
                checkbox.classList.toggle('selected', selectedFiles.has(pdfId));
            }
        });
    }
    
    function getCurrentPDFs() {
        if (currentTab === 'device') {
            // Device PDFs
            const pdfList = androidListPDFs();
            if (!pdfList) return [];
            
            return pdfList.split('||').map(path => {
                const name = path.split('/').pop();
                return {
                    id: path, // use path as ID
                    name: name,
                    path: path,
                    isFavorite: false
                };
            });
        } else if (currentTab === 'favorites') {
            return pdfs.filter(pdf => pdf.isFavorite);
        } else {
            return pdfs;
        }
    }

    // --- CONTEXT MENU ---
    function openContextMenu(pdfId) {
        currentContextPdf = pdfs.find(p => p.id == pdfId);
        if (!currentContextPdf) return;
        
        document.getElementById('contextOverlay').classList.add('show');
        document.getElementById('contextSheet').classList.add('show');
    }
    
    function closeContext() {
        document.getElementById('contextOverlay').classList.remove('show');
        document.getElementById('contextSheet').classList.remove('show');
        currentContextPdf = null;
    }
    
    function renamePdf() {
        if (!currentContextPdf) return;
        
        const newName = prompt('New name:', currentContextPdf.name);
        if (newName && newName.trim()) {
            currentContextPdf.name = newName.trim();
            androidShowToast('PDF renamed');
            loadPDFs();
        }
        closeContext();
    }
    
    function sharePdf() {
        if (!currentContextPdf || !currentContextPdf.path) return;
        androidSharePDF(currentContextPdf.path);
        closeContext();
    }
    
    function printPdf() {
        if (!currentContextPdf) return;
        androidShowToast('Preparing to print...');
        closeContext();
    }
    
    function deletePdf() {
        if (!currentContextPdf || !currentContextPdf.path) return;
        
        if (confirm('Are you sure you want to delete this PDF?')) {
            if (androidDeletePDF(currentContextPdf.path)) {
                pdfs = pdfs.filter(p => p.id !== currentContextPdf.id);
                androidShowToast('PDF deleted');
                loadPDFs();
            }
        }
        closeContext();
    }

    // --- MENU ACTIONS ---
    function openMenu() {
        document.getElementById('menuOverlay').classList.add('show');
        document.getElementById('menuSidebar').classList.add('open');
    }
    
    function closeMenu() {
        document.getElementById('menuOverlay').classList.remove('show');
        document.getElementById('menuSidebar').classList.remove('open');
    }
    
    function openSettings() {
        closeMenu();
        androidShowToast('Opening settings...');
    }
    
    function openHelp() {
        closeMenu();
        androidShowToast('Opening help...');
    }
    
    function openAbout() {
        closeMenu();
        androidShowToast('PDF Reader v1.0 - Dev Software');
    }

    // --- FAB MENU ---
    function openFabMenu() {
        document.getElementById('fileInput').click();
    }
    
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // Read file
        const reader = new FileReader();
        reader.onload = function(e) {
            const newPdf = {
                id: Date.now(),
                name: file.name,
                path: '', // Local file
                data: e.target.result, // Base64 data
                isFavorite: false,
                size: formatBytes(file.size),
                date: new Date().toLocaleDateString('en-US')
            };
            
            pdfs.unshift(newPdf);
            androidShowToast('PDF uploaded');
            loadPDFs();
        };
        
        reader.readAsDataURL(file);
        event.target.value = '';
    }
    
    function formatBytes(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / 1048576).toFixed(1) + ' MB';
    }

    // --- ANDROID BACK BUTTON ---
    window.androidBackPressed = function() {
        if (isSelectionMode) {
            exitSelection();
            return false;
        }
        
        if (document.getElementById('contextOverlay').classList.contains('show')) {
            closeContext();
            return false;
        }
        
        if (document.getElementById('menuOverlay').classList.contains('show')) {
            closeMenu();
            return false;
        }
        
        // If not on home, go back to home
        if (currentNav !== 'home') {
            switchNav('home');
            return false;
        }
        
        // Return true to exit (Android will handle)
        return true;
    };

    // --- ANDROID RESUME ---
    window.onAndroidResume = function() {
        loadPDFs();
    };

  </script>
</body>
</html>

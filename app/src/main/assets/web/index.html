<!doctype html>
<html lang=tr data-theme=light>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>PDF Reader | Dev Software</title>
<style>
@font-face{font-family:'Material Symbols Rounded';src:url('fonts/MaterialSymbolsRounded.woff2') format('woff2');font-weight:100 700;font-style:normal}.material-symbols-rounded{font-family:'Material Symbols Rounded';font-weight:400;font-style:normal;font-size:24px;display:inline-block;line-height:1;text-transform:none;letter-spacing:normal;word-wrap:normal;white-space:nowrap;direction:ltr;-webkit-font-smoothing:antialiased;font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 48}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}:root{--h-header:64px;--h-tabs:60px;--h-bottom:72px;--top-bar-total:calc(var(--h-header) + var(--h-tabs));--background:#e8e8e8;--surface:#e8e8e8;--primary:#E53935;--secondary:#B71C1C;--success:#4cc9f0;--error:#f94144;--text-primary:#0f172a;--text-secondary:#64748b;--border:#d4d4d4;--shadow-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--transition-fast:150ms ease;--transition-normal:250ms cubic-bezier(0.4, 0, 0.2, 1);--z-content:1;--z-top-bar:100;--z-bottom-nav:100;--z-overlay:2000;--z-context-menu:2100;--z-search-overlay:2300;--z-dialog:2400;--card-icon-size:36px;--card-padding:10px;--card-gutter:12px;--card-max-width:500px;--pdf-color-main:#E53935;--pdf-color-bg:#E53935;--pdf-color-text:#E53935;--selection-bg:rgba(229, 57, 53, 0.1);--selection-border:#E53935;--selection-overlay:rgba(229, 57, 53, 0.05)}[data-theme=dark]{--background:#0f172a;--surface:#1e293b;--text-primary:#f8fafc;--text-secondary:#cbd5e1;--border:#334155;--pdf-color-bg:#FF6961;--pdf-color-text:#B71C1C;--selection-bg:rgba(255, 105, 97, 0.15);--selection-border:#FF6961;--selection-overlay:rgba(255, 105, 97, 0.08)}*{margin:0;padding:0;box-sizing:border-box}body,html{height:100%;font-family:Roboto,sans-serif;background-color:var(--background);color:var(--text-primary);overflow:hidden}body{display:flex;flex-direction:column}.material-symbols-rounded{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;user-select:none}.flex{display:flex}.items-center{align-items:center}.gap-sm{gap:var(--spacing-sm)}.font-semibold{font-weight:600}.text-secondary{color:var(--text-secondary)}.text-sm{font-size:14px}.justify-between{justify-content:space-between}.flex-col{flex-direction:column}.mt-2{margin-top:8px}.mt-3{margin-top:12px}.mb-2{margin-bottom:8px}.text-center{text-align:center}.hidden{display:none!important}.top-bar-container{position:fixed;top:0;left:0;width:100%;z-index:var(--z-top-bar);background:var(--surface);transition:transform .4s cubic-bezier(.4, 0, .2, 1);box-shadow:var(--shadow-md);display:flex;flex-direction:column;transform:translateY(0)}.app-header{height:var(--h-header);display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid var(--border);background:var(--surface);transition:transform .4s cubic-bezier(.4, 0, .2, 1)}.header-content{display:flex;align-items:center;justify-content:space-between;width:100%}.logo-area{display:flex;align-items:center;gap:10px}.logo{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0}.logo img{width:100%;height:100%;object-fit:cover}.app-title{font-size:20px;font-weight:700;background:linear-gradient(to right,#b71c1c,#ff6961);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.icon-button{width:40px;height:40px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;background:0 0;border:none;color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast)}.icon-button:hover{background:rgba(0,0,0,.05);color:var(--text-primary)}.icon-button.primary{background:var(--primary);color:#fff}.tabs-container{height:var(--h-tabs);padding:0 16px;border-bottom:1px solid var(--border);background:var(--surface);transition:transform .4s cubic-bezier(.4, 0, .2, 1)}.tabs{display:flex;width:100%;height:100%;gap:4px}.tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;color:var(--text-secondary);font-weight:500;cursor:pointer;position:relative;transition:color var(--transition-fast);gap:2px}.tab-label{font-size:11px;line-height:1.2;font-weight:600}.tab.active{color:var(--primary)}.tab.active::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:3px;background:var(--primary);border-radius:3px 3px 0 0}.search-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--surface);z-index:var(--z-search-overlay);opacity:0;visibility:hidden;transition:all .3s ease;display:flex;flex-direction:column}.search-overlay.active{opacity:1;visibility:visible}.search-header{height:var(--h-header);display:flex;align-items:center;padding:0 16px;border-bottom:1px solid var(--border);background:var(--surface)}.search-input-wrapper{flex:1;background:rgba(0,0,0,.05);border-radius:20px;height:40px;display:flex;align-items:center;padding:0 12px;margin:0 8px}[data-theme=dark] .search-input-wrapper{background:rgba(255,255,255,.1)}.search-input{background:0 0;border:none;width:100%;height:100%;outline:0;font-family:Roboto,sans-serif;font-size:15px;color:var(--text-primary);margin-left:8px}.search-results{flex:1;overflow-y:auto;padding:16px}.search-result-count{font-size:12px;color:var(--text-secondary);margin-bottom:16px;padding:0 8px}.selection-header{display:none;padding:0 12px;align-items:center;justify-content:space-between;height:100%;width:100%}body.selection-mode .header-content{display:none!important}body.selection-mode .selection-header{display:flex!important}body.selection-mode .top-bar-container{background:var(--primary);color:#fff}body.selection-mode::after{content:'';position:fixed;top:var(--h-header);left:0;right:0;bottom:var(--h-bottom);background:var(--selection-overlay);z-index:var(--z-content);pointer-events:none}.selection-count{font-size:16px;font-weight:500;margin-left:8px;white-space:nowrap}.selection-actions{display:flex;align-items:center;gap:2px;overflow-x:auto}.icon-button.selection{color:#fff;width:36px;height:36px;flex-shrink:0}.icon-button.selection:hover{background:rgba(255,255,255,.1)}.main-content{padding-top:var(--top-bar-total);padding-bottom:var(--h-bottom);height:100vh;width:100%;overflow:hidden;position:relative;z-index:var(--z-content);transition:padding .4s cubic-bezier(.4, 0, .2, 1)}body:not(.is-home) .tabs-container{display:none!important}body:not(.is-home) .main-content{padding-top:var(--h-header)}.content-panel{position:absolute;top:0;left:0;width:100%;height:100%;overflow-y:auto;overscroll-behavior-y:contain;opacity:0;transform:translateX(20px);transition:opacity var(--transition-normal),transform var(--transition-normal);pointer-events:none;box-sizing:border-box;padding-top:var(--top-bar-total);padding-bottom:var(--h-bottom)}body:not(.is-home) .content-panel{padding-top:var(--h-header)}.content-panel.active{opacity:1;transform:translateX(0);pointer-events:all}.static-panel{padding-top:calc(var(--h-header) + 16px);overflow-y:auto}.permission-banner{margin:20px;background:var(--surface);border-radius:16px;padding:24px;text-align:center;border:1px solid var(--border);box-shadow:0 4px 12px rgba(0,0,0,.08);display:flex;flex-direction:column;align-items:center}.perm-icon{width:64px;height:64px;background:rgba(229,57,53,.1);border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;color:var(--primary);font-size:32px}.permission-banner h3{font-size:18px;font-weight:700;margin-bottom:8px;color:var(--text-primary)}.permission-banner p{font-size:14px;color:var(--text-secondary);margin-bottom:16px;line-height:1.5}.perm-note{width:100%;background:rgba(229,57,53,.05);border-radius:8px;padding:12px;font-size:12px;color:var(--text-secondary);margin-bottom:20px;display:flex;align-items:flex-start;gap:8px;text-align:left;border:1px solid rgba(229,57,53,.1)}[data-theme=dark] .perm-note{background:rgba(255,105,97,.05);color:#cbd5e1;border-color:rgba(255,105,97,.1)}.permission-banner button{width:100%;padding:14px;background:var(--primary);color:#fff;border:none;border-radius:12px;font-weight:600;font-size:15px;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 10px rgba(229,57,53,.3);cursor:pointer;transition:transform .2s}.permission-banner button:active{transform:scale(.98)}.grid{display:grid;gap:10px;grid-template-columns:1fr;padding:16px;width:100%}.static-panel .grid{padding-top:0!important;padding-bottom:120px}.card{background:var(--surface);border-radius:12px;border:1px solid var(--border);padding:12px;transition:all var(--transition-normal);cursor:pointer;box-shadow:var(--shadow-md);display:flex;align-items:center;gap:12px;width:100%;max-width:var(--card-max-width);margin:0 auto;user-select:none;-webkit-user-select:none;position:relative}.card:active{transform:scale(.98);background:rgba(0,0,0,.02)}.card.hidden{display:none!important}.card-icon-svg-wrapper{width:var(--card-icon-size);height:var(--card-icon-size);flex-shrink:0;margin-left:4px}.card-details{flex-grow:1;flex-basis:50%;min-width:0;display:flex;flex-direction:column;justify-content:center}.card-title{font-size:14px;font-weight:600;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.card-meta{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-secondary);margin-top:2px}.card-actions{display:flex;align-items:center;flex-shrink:0}.selection-checkbox{position:absolute;top:12px;left:12px;width:20px;height:20px;border:2px solid var(--text-secondary);border-radius:4px;background:var(--surface);z-index:2;display:none}body.selection-mode .selection-checkbox{display:block}body.selection-mode .card{position:relative;cursor:default}body.selection-mode .card:active{transform:none;background:var(--surface)}body.selection-mode .card.selected{background:var(--selection-bg);border-color:var(--selection-border);border-width:2px}.selection-checkbox.selected{background:var(--primary);border-color:var(--primary)}.selection-checkbox.selected::after{content:'✓';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;font-weight:700}.tools-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:16px}.tool-card{background:var(--surface);border-radius:12px;border:1px solid var(--border);padding:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;cursor:pointer;transition:all var(--transition-normal);box-shadow:var(--shadow-md);min-height:120px}.tool-card:active{transform:scale(.98);background:rgba(0,0,0,.02)}.tool-icon-wrapper{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:12px;font-size:28px}.tool-title{font-size:13px;font-weight:600;color:var(--text-primary);line-height:1.3}.menu-list{display:flex;flex-direction:column;background:var(--surface);border-radius:16px;width:calc(100% - 2 * 16px);max-width:calc(var(--card-max-width) + 24px);margin:0 auto}.menu-item{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer;border-bottom:1px solid var(--border);transition:background-color .1s}.menu-item:last-child{border-bottom:none}.menu-item:active{background-color:rgba(0,0,0,.05)}.menu-item-info{display:flex;align-items:center;gap:16px}.menu-icon-wrapper{width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:26px}.menu-label-wrapper{display:flex;flex-direction:column}.menu-label{font-size:15px;font-weight:500;line-height:1.2}.menu-sublabel{font-size:11px;color:var(--text-secondary);line-height:1.2}.icon-device{color:var(--text-primary)}.icon-shared{color:var(--primary)}.icon-photos{color:#f94144}.icon-yandex{color:red}.icon-mega{background-color:#d60914;color:#fff;border-radius:4px;font-size:16px!important;padding:4px}.icon-gdrive{color:#34a853}.icon-onedrive{color:#0078d4}.icon-dropbox{color:#0061ff}.icon-gmail{background-color:#ea4335;color:#fff;border-radius:4px;font-size:16px!important;padding:4px}.icon-folder-open{color:var(--text-secondary)}.bottom-nav{height:var(--h-bottom);background:var(--surface);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-around;position:fixed;bottom:0;width:100%;z-index:var(--z-bottom-nav);padding-bottom:env(safe-area-inset-bottom)}.nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;color:var(--text-secondary);cursor:pointer;transition:color var(--transition-fast)}.nav-item.active{color:var(--primary)}.nav-label{font-size:11px;font-weight:500}.fab-container{position:fixed;bottom:90px;right:24px;z-index:var(--z-bottom-nav)}.fab{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));border:none;color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 20px rgba(0,0,0,.2);cursor:pointer}.fab-menu{position:absolute;bottom:70px;right:0;background:var(--surface);border-radius:12px;padding:8px;width:180px;box-shadow:0 4px 12px rgba(0,0,0,.15);opacity:0;transform:translateY(10px);pointer-events:none;transition:all .2s;border:1px solid var(--border)}.fab-menu.show{opacity:1;transform:translateY(0);pointer-events:all}.fab-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;cursor:pointer}.fab-item:active{background:rgba(0,0,0,.05)}.drawer-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:var(--z-overlay);opacity:0;visibility:hidden;transition:.3s}.drawer-overlay.show{opacity:1;visibility:visible}.drawer{position:fixed;top:0;left:0;bottom:0;width:280px;background:var(--surface);z-index:var(--z-overlay);transform:translateX(-100%);transition:.3s;display:flex;flex-direction:column}.drawer.open{transform:translateX(0)}.drawer-header{padding:32px 24px 16px 24px;background:var(--surface);color:var(--text-primary);border-bottom:2px solid var(--primary);display:flex;align-items:center;gap:12px;flex-shrink:0}.drawer-header h3{font-size:24px;font-weight:700;background:linear-gradient(to right,#b71c1c,#ff6961);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;display:inline}.drawer-logo{width:36px;height:36px;border-radius:50%;overflow:hidden;flex-shrink:0}.drawer-logo img{width:100%;height:100%;object-fit:cover}.drawer-content{padding:16px;overflow-y:auto}.drawer-item{padding:12px;display:flex;gap:16px;align-items:center;border-radius:8px;margin-bottom:4px;cursor:pointer;transition:background-color .1s}.drawer-item:hover{background:rgba(0,0,0,.05)}.drawer-item:active{background:rgba(0,0,0,.1)}.drawer-accordion-content{background:rgba(0,0,0,.03);border-radius:8px;margin-top:-4px;margin-bottom:8px;padding:0 16px;max-height:0;overflow:hidden;transition:max-height .4s ease-in-out,padding .4s ease-in-out;box-shadow:inset 0 1px 3px rgba(0,0,0,.05)}.drawer-accordion-content.open{max-height:500px;padding:12px 16px;border:1px solid var(--border)}.context-sheet-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:var(--z-context-menu);opacity:0;visibility:hidden;transition:opacity .3s}.context-sheet-overlay.show{opacity:1;visibility:visible}.context-sheet{position:fixed;bottom:0;left:0;width:100%;background:var(--surface);z-index:var(--z-context-menu);border-radius:20px 20px 0 0;transform:translateY(100%);transition:transform .3s cubic-bezier(.4, 0, .2, 1);padding:24px 0;border-top:1px solid var(--border)}.context-sheet.show{transform:translateY(0)}.sheet-handle{width:40px;height:4px;background:var(--text-secondary);border-radius:2px;margin:-10px auto 20px auto;opacity:.3}.sheet-header{padding:0 24px 16px 24px;border-bottom:1px solid var(--border);margin-bottom:8px}.sheet-title{font-size:16px;font-weight:600;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sheet-meta{font-size:12px;color:var(--text-secondary)}.sheet-item{display:flex;align-items:center;gap:16px;padding:12px 24px;cursor:pointer;font-weight:500;color:var(--text-primary)}.sheet-item:active{background:rgba(0,0,0,.05)}.sheet-item.danger{color:var(--error)}.sheet-item .material-symbols-rounded{font-size:24px;color:inherit}.settings-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:12px}.setting-tab{flex:1;padding:8px 4px;text-align:center;font-size:12px;font-weight:600;cursor:pointer;color:var(--text-secondary);border-bottom:2px solid transparent;transition:all var(--transition-fast)}.setting-tab.active{color:var(--primary);border-bottom:2px solid var(--primary)}.setting-panel{padding:8px 0;display:none;animation:fadeIn .3s}.setting-panel.active{display:block}@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}.select-placeholder{padding:10px;border:1px solid var(--border);border-radius:8px;margin-top:8px;color:var(--text-primary);background:var(--surface);display:block;width:100%;text-align:left}.theme-options{display:flex;gap:16px;margin-top:12px}.theme-option{flex:1;text-align:center;padding:12px 8px;border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:all var(--transition-fast)}.theme-option.active{border-color:var(--primary);box-shadow:0 0 0 2px rgba(var(--primary-rgb),.3);background:rgba(var(--primary-rgb),.05)}.theme-option .material-symbols-rounded{font-size:32px;margin-bottom:4px;color:var(--text-secondary)}.theme-option.active .material-symbols-rounded{color:var(--primary)}.theme-option p{font-size:12px;font-weight:500}.help-form button,.help-form input,.help-form textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid var(--border);border-radius:8px;box-sizing:border-box;background:var(--surface);color:var(--text-primary)}.help-form textarea{resize:vertical;min-height:100px}.help-form button{background-color:var(--primary);color:#fff;font-weight:600;cursor:pointer;transition:background-color var(--transition-fast)}.help-form button:hover{background-color:var(--secondary)}.empty-state{padding:40px;text-align:center;color:var(--text-secondary)}.empty-icon{font-size:48px;margin-bottom:16px;opacity:.5}#loadingIndicator{display:none;text-align:center;padding:60px 20px;color:var(--text-secondary)}.top-bar-container.hidden{transform:translateY(calc(-1 * var(--h-header)))}.top-bar-container.hidden .tabs-container{position:fixed;top:0;left:0;width:100%;z-index:var(--z-top-bar);background:var(--surface);box-shadow:var(--shadow-md)}.top-bar-container.hidden .tabs-container{transform:translateY(var(--h-header))}.dialog-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:var(--z-dialog);opacity:0;visibility:hidden;transition:opacity .3s;display:flex;align-items:center;justify-content:center;padding:20px}.dialog-overlay.show{opacity:1;visibility:visible}.dialog{background:var(--surface);border-radius:20px;width:100%;max-width:400px;box-shadow:0 10px 40px rgba(0,0,0,.2);overflow:hidden;transform:translateY(20px);transition:transform .3s}.dialog-overlay.show .dialog{transform:translateY(0)}.dialog-header{padding:24px 24px 16px;border-bottom:1px solid var(--border);position:relative}.dialog-title{font-size:20px;font-weight:600;color:var(--text-primary);margin:0}.dialog-close{position:absolute;top:20px;right:20px;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:0 0;border:none;color:var(--text-secondary);cursor:pointer;transition:background-color .2s}.dialog-close:hover{background:rgba(0,0,0,.05)}.dialog-content{padding:24px}.dialog-input{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:Roboto,sans-serif;background:var(--surface);color:var(--text-primary);margin-bottom:20px;transition:border-color .2s}.dialog-input:focus{outline:0;border-color:var(--primary)}.dialog-footer{display:flex;gap:12px;padding:0 24px 24px}.dialog-button{flex:1;padding:14px;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s}.dialog-button.cancel{background:var(--background);color:var(--text-primary);border:1px solid var(--border)}.dialog-button.cancel:hover{background:rgba(0,0,0,.05)}.dialog-button.primary{background:var(--primary);color:#fff;box-shadow:0 4px 12px rgba(229,57,53,.3)}.dialog-button.primary:hover{background:var(--secondary);transform:translateY(-2px);box-shadow:0 6px 16px rgba(229,57,53,.4)}.dialog-button.primary:active{transform:translateY(0)}.print-status{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--surface);border-radius:16px;padding:24px;z-index:var(--z-dialog);box-shadow:0 10px 40px rgba(0,0,0,.3);text-align:center;min-width:280px;opacity:0;visibility:hidden;transition:all .3s}.print-status.show{opacity:1;visibility:visible}.print-status-icon{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;margin:0 auto 16px;color:#fff;font-size:32px}.print-status-title{font-size:18px;font-weight:600;margin-bottom:8px;color:var(--text-primary)}.print-status-text{font-size:14px;color:var(--text-secondary);margin-bottom:16px}.print-progress{width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin:16px 0}.print-progress-bar{height:100%;background:linear-gradient(to right,var(--primary),var(--secondary));border-radius:3px;transition:width .3s}
</style>
</head>
<body>
<input type=file id=pdfFileInput accept=application/pdf style=display:none>
<div class=top-bar-container id=topBar>
<header class=app-header>
<div class=header-content id=headerNormal>
<div class=logo-area>
<div class=logo>
<img src=logo/logo.png alt="PDF Reader Logo">
</div>
<h1 class=app-title>PDF Reader</h1>
</div>
<div class="flex items-center gap-sm">
<button class=icon-button id=searchBtn><span class=material-symbols-rounded>search</span></button>
<button class=icon-button id=menuBtn><span class=material-symbols-rounded>menu</span></button>
</div>
</div>
<div class=selection-header id=selectionHeader>
<div class=selection-count id=selectionCount>0 öğe seçildi</div>
<div class=selection-actions>
<button class="icon-button selection" title="Tümünü Seç" onclick=selectAllCards()>
<span class=material-symbols-rounded>select_all</span>
</button>
<button class="icon-button selection" title="Seçimi Kaldır" onclick=deselectAllCards()>
<span class=material-symbols-rounded>deselect</span>
</button>
<button class="icon-button selection" title=Paylaş onclick=shareSelectedCards()>
<span class=material-symbols-rounded>share</span>
</button>
<button class="icon-button selection" title=Yazdır onclick=printSelectedCards()>
<span class=material-symbols-rounded>print</span>
</button>
<button class="icon-button selection" title=Sil onclick=deleteSelectedCards()>
<span class=material-symbols-rounded>delete</span>
</button>
<button class="icon-button selection" title=Kapat onclick=exitSelectionMode()>
<span class=material-symbols-rounded>close</span>
</button>
</div>
</div>
</header>
<div class=tabs-container id=tabsContainer>
<div class=tabs>
<div class="tab active" data-tab=recent>
<span class=material-symbols-rounded>history</span>
<span class=tab-label>Son Kullanılanlar</span>
</div>
<div class=tab data-tab=device>
<span class=material-symbols-rounded>phone_iphone</span>
<span class=tab-label>Cihazda</span>
</div>
<div class=tab data-tab=favorites>
<span class=material-symbols-rounded>star</span>
<span class=tab-label>Favoriler</span>
</div>
</div>
</div>
</div>
<div class=search-overlay id=searchOverlay>
<div class=search-header>
<button class=icon-button id=closeSearchBtn>
<span class=material-symbols-rounded>arrow_back</span>
</button>
<div class=search-input-wrapper>
<span class="material-symbols-rounded text-secondary" style=font-size:20px>search</span>
<input class=search-input id=searchInput placeholder="PDF dosyalarında ara...">
</div>
<button class=icon-button onclick=clearSearch()>
<span class=material-symbols-rounded>close</span>
</button>
</div>
<div class=search-result-count id=searchResultCount></div>
<div class=search-results id=searchResults>
</div>
</div>
<main class=main-content id=mainContent>
<div class="content-panel active" id=recentPanel>
<div class=grid id=recentList></div>
</div>
<div class=content-panel id=devicePanel>
<div class=permission-banner id=permissionContainer>
<div class=perm-icon>
<span class=material-symbols-rounded>folder_off</span>
</div>
<h3>Cihazınızdaki PDF'lere erişebilmem için izin gerekli</h3>
<p>"Tüm Dosyalara Erişim" iznini vermeniz gerekiyor. Butona tıklayarak ayarlara yönlendirileceksiniz.</p>
<div class=perm-note>
<span class=material-symbols-rounded style=font-size:18px;color:var(--primary)>info</span>
<span>Lütfen açılan ayarlar ekranında <strong>"Tüm dosyalara erişim izni ver"</strong> seçeneğini aktif ediniz.</span>
</div>
<button onclick=openAndroidPermissionSettings()>
<span class=material-symbols-rounded>settings</span>
Ayarlardan Erişim Ver
</button>
</div>
<div class=grid id=deviceList></div>
<div id=loadingIndicator>
<div class="empty-icon material-symbols-rounded" style="animation:spin 1s linear infinite">sync</div>
<p>PDF'ler taranıyor...</p>
</div>
</div>
<div class=content-panel id=favoritesPanel>
<div class=grid id=favoritesList></div>
</div>
<div class="content-panel static-panel" id=filesPanel>
<div class=grid>
<div class=menu-list>
<div class=menu-item onclick='handleFileSource("device")'>
<div class=menu-item-info>
<span class="material-symbols-rounded menu-icon-wrapper icon-device">phone_android</span>
<span class=menu-label>Bu aygıtta</span>
</div>
<span class="material-symbols-rounded text-secondary">chevron_right</span>
</div>
<div class=menu-item onclick='handleFileSource("gdrive")'>
<div class=menu-item-info>
<span class="material-symbols-rounded menu-icon-wrapper icon-gdrive">drive_file_move</span>
<span class=menu-label>Google Drive</span>
</div>
<span class="material-symbols-rounded text-secondary">add</span>
</div>
<div class=menu-item onclick='handleFileSource("onedrive")'>
<div class=menu-item-info>
<span class="material-symbols-rounded menu-icon-wrapper icon-onedrive">cloud</span>
<span class=menu-label>OneDrive</span>
</div>
<span class="material-symbols-rounded text-secondary">add</span>
</div>
<div class=menu-item onclick='handleFileSource("dropbox")'>
<div class=menu-item-info>
<span class="material-symbols-rounded menu-icon-wrapper icon-dropbox">interests</span>
<span class=menu-label>Dropbox</span>
</div>
<span class="material-symbols-rounded text-secondary">add</span>
</div>
<div class=menu-item onclick='handleFileSource("gmail")'>
<div class=menu-item-info>
<span class="material-symbols-rounded menu-icon-wrapper icon-gmail">mail</span>
<div class=menu-label-wrapper>
<span class=menu-label>E-postalardaki PDF'ler</span>
<span class=menu-sublabel>Gmail</span>
</div>
</div>
<span class="material-symbols-rounded text-secondary">add</span>
</div>
<div class=menu-item onclick='handleFileSource("browse_more")'>
<div class=menu-item-info>
<span class="material-symbols-rounded menu-icon-wrapper icon-folder_open">folder_open</span>
<span class=menu-label>Daha fazla dosyaya göz atın</span>
</div>
<span class="material-symbols-rounded text-secondary">chevron_right</span>
</div>
</div>
</div>
</div>
<div class="content-panel static-panel" id=toolsPanel>
<div class=tools-grid id=toolsGrid>
</div>
</div>
</main>
<div class=fab-container>
<div class=fab-menu id=fabMenu>
<div class=fab-item onclick='handleFabAction("ocr")'>
<span class=material-symbols-rounded>document_scanner</span>
Belge Tara (OCR)
</div>
<div class=fab-item onclick='handleFabAction("import")'>
<span class=material-symbols-rounded>upload_file</span>
PDF Yükle
</div>
</div>
<button class=fab id=fabButton><span class=material-symbols-rounded>add</span></button>
</div>
<nav class=bottom-nav>
<div class="nav-item active" data-nav=home>
<span class=material-symbols-rounded>home</span>
<span class=nav-label>Ana Sayfa</span>
</div>
<div class=nav-item data-nav=tools>
<span class=material-symbols-rounded>tune</span>
<span class=nav-label>Araçlar</span>
</div>
<div class=nav-item data-nav=files>
<span class=material-symbols-rounded>folder</span>
<span class=nav-label>Dosyalar</span>
</div>
</nav>
<div class=drawer-overlay id=drawerOverlay></div>
<aside class=drawer id=drawer>
<div class=drawer-header>
<div class=drawer-logo>
<img src=logo/logo.png alt="PDF Reader Logo">
</div>
<h3>PDF Reader</h3>
</div>
<div class=drawer-content>
<div class=drawer-item data-accordion=about>
<span class=material-symbols-rounded>info</span>
Hakkında
</div>
<div class=drawer-accordion-content id=accordion-about>
<p><strong>PDF Reader by Dev Software</strong></p>
<p>Bu uygulama, PDF dosyalarını hızlı, güvenli ve verimli bir şekilde görüntülemek, yönetmek ve temel düzeyde düzenlemek için tasarlanmıştır.</p>
<p>Amacımız, en iyi mobil PDF deneyimini sunmaktır. Devam eden güncellemeler ve iyileştirmeler için bizi takipte kalın!</p>
<p class="text-sm mt-3">Tüm Hakları Saklıdır &copy; 2025 Dev Software.</p>
</div>
<div class=drawer-item data-accordion=settings>
<span class=material-symbols-rounded>settings</span>
Ayarlar & Tercihler
</div>
<div class=drawer-accordion-content id=accordion-settings>
<div class=settings-tabs>
<div class="setting-tab active" data-tab=app-lang>Uygulama Dili</div>
<div class=setting-tab data-tab=pdf-lang>PDF Dili</div>
<div class=setting-tab data-tab=theme>Tema</div>
</div>
<div class="setting-panel active" data-panel=app-lang>
<p class="text-sm font-semibold">Uygulama arayüzünün dilini seçin.</p>
<select class=select-placeholder onchange='log("Uygulama dili değiştirildi: "+this.value)'>
<option value="" disabled selected>Uygulama Dili Seçiniz</option>
<option value=tr>Türkçe (Turkish)</option>
<option value=en>İngilizce (English)</option>
</select>
</div>
<div class=setting-panel data-panel=pdf-lang>
<p class="text-sm font-semibold">PDF'leri görüntüleme ve metin kopyalama/arama için OCR dilini seçin.</p>
<select class=select-placeholder onchange='log("PDF dili değiştirildi: "+this.value)'>
<option value="" disabled selected>Görüntüleyici Dili Seçiniz (50+ Dil)</option>
<option value=tr>Türkçe</option>
<option value=en>İngilizce</option>
</select>
</div>
<div class=setting-panel data-panel=theme>
<p class="text-sm font-semibold mb-2">Uygulamanın görünümünü seçin.</p>
<div class=theme-options>
<div class="theme-option active" data-theme-val=device onclick='setThemePreference("device")'>
<span class=material-symbols-rounded>phone_android</span>
<p>Cihaz</p>
</div>
<div class=theme-option data-theme-val=light onclick='setThemePreference("light")'>
<span class=material-symbols-rounded>light_mode</span>
<p>Light</p>
</div>
<div class=theme-option data-theme-val=dark onclick='setThemePreference("dark")'>
<span class=material-symbols-rounded>dark_mode</span>
<p>Dark</p>
</div>
</div>
<p class="text-sm text-secondary mt-3">Varsayılan olarak cihaz ayarları kullanılır. Seçiminiz tarayıcınızda saklanacaktır.</p>
</div>
</div>
<div class=drawer-item data-accordion=privacy>
<span class=material-symbols-rounded>lock</span>
Gizlilik
</div>
<div class=drawer-accordion-content id=accordion-privacy>
<p>Kişisel verilerinizin ve belge gizliliğinizin bizim için en önemli öncelik olduğunu garanti ederiz. Uygulama, dosyalarınızı sunucularımıza yüklemeden cihazınızda yerel olarak işleyecek şekilde tasarlanmıştır.</p>
<p><strong>Dev Software</strong> olarak, kullanıcılarımızın hiçbir kişisel verisini üçüncü taraflarla paylaşmayız.</p>
<p class="mt-3 font-semibold">Daha fazla bilgi için:</p>
<a href=# onclick='log("Gizlilik Politikası sayfası")' class="text-sm text-primary">Gizlilik Politikası için Tıklayınız</a>
</div>
<div class=drawer-item data-accordion=help>
<span class=material-symbols-rounded>help</span>
Yardım
</div>
<div class=drawer-accordion-content id=accordion-help>
<form class=help-form onsubmit=sendHelpEmail(event)>
<p class="text-sm mb-2">Sorununuzu bize iletin. Ekibimiz en kısa sürede dönüş yapacaktır.</p>
<input type=email id=helpEmail placeholder="E-posta Adresiniz" required>
<input id=helpSubject placeholder="Konu Başlığı" required>
<textarea id=helpIssue placeholder="Sorununuzu detaylıca açıklayınız..." required></textarea>
<button type=submit>Gönder</button>
<p class="text-sm text-secondary text-center mt-2">Bu e-posta devsoftawaremail@gmail.com adresine yönlendirilecektir.</p>
</form>
</div>
</div>
</aside>
<div class=context-sheet-overlay id=contextOverlay></div>
<div class=context-sheet id=contextSheet>
<div class=sheet-handle></div>
<div class=sheet-header>
<h3 class=sheet-title id=contextTitle>Belge Adı.pdf</h3>
<span class=sheet-meta id=contextMeta>2.5 MB • 12.05.2025</span>
</div>
<div class=sheet-item onclick='handleContextAction("rename")'>
<span class=material-symbols-rounded>edit</span>
Yeniden Adlandır
</div>
<div class=sheet-item onclick='handleContextAction("share")'>
<span class=material-symbols-rounded>share</span>
Paylaş
</div>
<div class=sheet-item onclick='handleContextAction("print")'>
<span class=material-symbols-rounded>print</span>
Yazdır
</div>
<div class="sheet-item danger" onclick='handleContextAction("delete")'>
<span class=material-symbols-rounded>delete</span>
Sil
</div>
</div>
<div class=dialog-overlay id=renameDialog>
<div class=dialog>
<div class=dialog-header>
<h3 class=dialog-title>Dosyayı Yeniden Adlandır</h3>
<button class=dialog-close onclick=closeRenameDialog()>
<span class=material-symbols-rounded>close</span>
</button>
</div>
<div class=dialog-content>
<p class="text-sm text-secondary mb-3" id=renameOldName>Eski ad: </p>
<input class=dialog-input id=newFileNameInput placeholder="Yeni dosya adı girin" maxlength=100>
<p class="text-sm text-secondary">.pdf uzantısı otomatik eklenecektir</p>
</div>
<div class=dialog-footer>
<button class="dialog-button cancel" onclick=closeRenameDialog()>İptal</button>
<button class="dialog-button primary" onclick=confirmRenameFile()>Kaydet</button>
</div>
</div>
</div>
<script>
// ============ GLOBAL DEĞİŞKENLER ============
const topBar = document.getElementById("topBar"),
    mainContent = document.getElementById("mainContent"),
    tabs = document.querySelectorAll(".tab"),
    panels = document.querySelectorAll(".content-panel"),
    navItems = document.querySelectorAll(".nav-item"),
    fabButton = document.getElementById("fabButton"),
    fabMenu = document.getElementById("fabMenu"),
    drawer = document.getElementById("drawer"),
    overlay = document.getElementById("drawerOverlay"),
    drawerItems = document.querySelectorAll(".drawer-item[data-accordion]"),
    settingsTabs = document.querySelectorAll(".setting-tab"),
    themeOptions = document.querySelectorAll(".theme-option"),
    pdfFileInput = document.getElementById("pdfFileInput"),
    searchBtn = document.getElementById("searchBtn"),
    searchOverlay = document.getElementById("searchOverlay"),
    searchInput = document.getElementById("searchInput"),
    closeSearchBtn = document.getElementById("closeSearchBtn"),
    searchResults = document.getElementById("searchResults"),
    searchResultCount = document.getElementById("searchResultCount"),
    contextOverlay = document.getElementById("contextOverlay"),
    contextSheet = document.getElementById("contextSheet"),
    contextTitle = document.getElementById("contextTitle"),
    contextMeta = document.getElementById("contextMeta");

let currentContextFile = null;
const renameDialog = document.getElementById("renameDialog"),
    newFileNameInput = document.getElementById("newFileNameInput"),
    renameOldName = document.getElementById("renameOldName"),
    selectionHeader = document.getElementById("selectionHeader"),
    selectionCount = document.getElementById("selectionCount");

let isSelectionMode = false,
    selectedCards = new Set(),
    importedFiles = [],
    devicePDFs = [],
    recentFiles = [],
    favoriteFiles = [];

const PDF_READER_FOLDER = "/storage/emulated/0/Download/PDF Reader";
let lastScrollY = 0,
    startX = 0,
    startY = 0,
    isSwiping = false,
    isVerticalScroll = false;
const headerHeight = 64;
let currentNav = "home";
const tabOrder = ["recent", "device", "favorites"];
let isHeaderHidden = false;
const HIDE_THRESHOLD = 50,
    SHOW_THRESHOLD = 10;

// ============ LOG FONKSİYONU (alert yerine) ============
function log(message) {
    console.log("[PDF Reader]: " + message);
    if (typeof Android !== 'undefined' && Android.logMessage) {
        Android.logMessage(message);
    }
}

// ============ CACHE İŞLEMLERİ ============
function saveToCache() {
    try {
        const data = {
            importedFiles: importedFiles,
            devicePDFs: devicePDFs,
            theme: localStorage.getItem("pdfTheme") || "light",
            timestamp: Date.now()
        };
        localStorage.setItem("pdfReaderData", JSON.stringify(data));
        log("Veriler cache'e kaydedildi");
    } catch (e) {
        console.error("Cache kaydetme hatası:", e);
    }
}

function loadFromCache() {
    try {
        const cached = localStorage.getItem("pdfReaderData");
        if (cached) {
            const data = JSON.parse(cached);
            const oneDayAgo = 24 * 60 * 60 * 1000;
            if (Date.now() - data.timestamp > oneDayAgo) {
                log("Eski cache temizlendi");
                localStorage.removeItem("pdfReaderData");
                return false;
            }
            importedFiles = data.importedFiles || [];
            devicePDFs = data.devicePDFs || [];
            if (data.theme) {
                localStorage.setItem("pdfTheme", data.theme);
            }
            log("Veriler cache'den yüklendi");
            return true;
        }
    } catch (e) {
        console.error("Cache yükleme hatası:", e);
        localStorage.removeItem("pdfReaderData");
    }
    return false;
}

// ============ PDF İŞLEMLERİ ============
function checkAndroidPermission() {
    try {
        return typeof Android !== 'undefined' && Android.checkPermission && Android.checkPermission();
    } catch (e) {
        console.error("Permission check error:", e);
        return false;
    }
}

function openAndroidPermissionSettings() {
    try {
        if (typeof Android !== 'undefined' && Android.openAllFilesSettings) {
            Android.openAllFilesSettings();
        } else {
            log("Android bağlantısı kurulamadı. Lütfen uygulama ayarlarından izin verin.");
        }
    } catch (e) {
        console.error("Open settings error:", e);
    }
}

function updatePermissionUI(hasPermission) {
    const permContainer = document.getElementById("permissionContainer");
    const deviceList = document.getElementById("deviceList");
    const loadingIndicator = document.getElementById("loadingIndicator");
    
    if (hasPermission) {
        if (permContainer) permContainer.style.display = "none";
        if (deviceList) deviceList.style.display = "grid";
        if (loadingIndicator) loadingIndicator.style.display = "block";
        scanDeviceForPDFs();
    } else {
        if (permContainer) permContainer.style.display = "flex";
        if (deviceList) deviceList.style.display = "none";
        if (loadingIndicator) loadingIndicator.style.display = "none";
    }
}

function scanDeviceForPDFs() {
    try {
        const loadingIndicator = document.getElementById("loadingIndicator");
        const deviceList = document.getElementById("deviceList");
        
        if (loadingIndicator) loadingIndicator.style.display = "block";
        if (deviceList) deviceList.style.display = "none";
        
        let scannedPDFs = [];
        
        if (typeof Android !== 'undefined' && Android.listPDFs) {
            const result = Android.listPDFs();
            log("PDF List Result: " + result);
            
            if (result === "PERMISSION_DENIED") {
                updatePermissionUI(false);
                return;
            }
            
            if (result && result.trim().length > 0 && result !== "EMPTY" && !result.startsWith("ERROR")) {
                scannedPDFs = result.split("||").filter(p => p && p.trim().length > 0);
            }
        }
        
        const existingPDFs = devicePDFs || [];
        const updatedPDFs = [];
        let nextId = Math.max(1000, ...existingPDFs.map(p => p.id), 0) + 1;
        
        for (const path of scannedPDFs) {
            const fileName = path.split("/").pop();
            const existing = existingPDFs.find(p => p.path === path);
            
            if (existing) {
                existing.size = getRealFileSize(path);
                existing.date = getRealFileDate(path);
                updatedPDFs.push(existing);
            } else {
                updatedPDFs.push({
                    id: nextId++,
                    name: fileName,
                    size: getRealFileSize(path),
                    date: getRealFileDate(path),
                    isFavorite: false,
                    path: path,
                    lastOpened: null
                });
            }
        }
        
        devicePDFs = updatedPDFs;
        
        if (loadingIndicator) loadingIndicator.style.display = "none";
        if (deviceList) deviceList.style.display = "grid";
        
        loadData();
        
    } catch (e) {
        console.error("Device scan error:", e);
        const loadingIndicator = document.getElementById("loadingIndicator");
        if (loadingIndicator) loadingIndicator.style.display = "none";
        devicePDFs = devicePDFs || [];
        loadData();
    }
}

function getRealFileSize(path) {
    try {
        if (typeof Android !== 'undefined' && Android.getFileSize) {
            const size = parseInt(Android.getFileSize(path));
            return !isNaN(size) && size > 0 ? formatBytes(size) : getFallbackFileSize(path);
        }
        return getFallbackFileSize(path);
    } catch (e) {
        console.error("File size error:", e);
        return getFallbackFileSize(path);
    }
}

function getFallbackFileSize(path) {
    const lowerPath = path.toLowerCase();
    if (lowerPath.includes("large") || lowerPath.includes("big")) return "4.2 MB";
    if (lowerPath.includes("small") || lowerPath.includes("tiny")) return "450 KB";
    if (lowerPath.includes("report") || lowerPath.includes("document")) return "2.1 MB";
    if (lowerPath.includes("book") || lowerPath.includes("manual")) return "3.8 MB";
    if (lowerPath.includes("invoice") || lowerPath.includes("bill")) return "1.5 MB";
    const sizes = ["850 KB", "1.2 MB", "2.5 MB", "3.8 MB", "4.2 MB"];
    return sizes[Math.floor(Math.random() * sizes.length)];
}

function getRealFileDate(path) {
    try {
        if (typeof Android !== 'undefined' && Android.getFileDate) {
            const dateStr = Android.getFileDate(path);
            if (dateStr && dateStr !== "ERROR") {
                const date = new Date(dateStr);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                return `${day}.${month}.${date.getFullYear()}`;
            }
            return getFallbackFileDate();
        }
        return getFallbackFileDate();
    } catch (e) {
        console.error("File date error:", e);
        return getFallbackFileDate();
    }
}

function getFallbackFileDate() {
    const today = new Date();
    const randomDays = Math.floor(30 * Math.random());
    const randomDate = new Date(today);
    randomDate.setDate(today.getDate() - randomDays);
    return `${String(randomDate.getDate()).padStart(2, '0')}.${String(randomDate.getMonth() + 1).padStart(2, '0')}.${randomDate.getFullYear()}`;
}

// ============ PERMISSION CALLBACKS ============
function onPermissionGranted() {
    log("İzin verildi");
    updatePermissionUI(true);
}

function onPermissionDenied() {
    log("İzin verilmedi");
    updatePermissionUI(false);
}

function checkPermissionOnResume() {
    const hasPermission = checkAndroidPermission();
    log("Resume permission check: " + hasPermission);
    updatePermissionUI(hasPermission);
}

function checkInitialPermission() {
    const hasPermission = checkAndroidPermission();
    log("Initial permission check: " + hasPermission);
    updatePermissionUI(hasPermission);
}

// ============ TOOLS ============
function loadTools() {
    const toolsGrid = document.getElementById("toolsGrid");
    if (!toolsGrid) return;
    
    const toolsData = [
        { id: 1, title: "PDF Birleştirme", iconCode: "merge", color: "#E53935", page: "birlestirme.html" },
        { id: 2, title: "Sesli Okuma", iconCode: "volume_up", color: "#4CAF50", page: "sesli_okuma.html" },
        { id: 3, title: "OCR Metin Çıkarma", iconCode: "text_fields", color: "#2196F3", page: "orc.html" },
        { id: 4, title: "PDF İmzalama", iconCode: "draw", color: "#9C27B0", page: "imza.html" },
        { id: 5, title: "PDF Sıkıştırma", iconCode: "compress", color: "#FF9800", page: "sikistirma.html" },
        { id: 6, title: "PDF Sayfalarını Organize Etme", iconCode: "reorder", color: "#795548", page: "organize.html" },
        { id: 7, title: "Resimden PDF", iconCode: "image", color: "#00BCD4", page: "resimden_pdf.html" },
        { id: 8, title: "PDF'den Resim", iconCode: "picture_as_pdf", color: "#607D8B", page: "pdf_resme.html" }
    ];
    
    let html = "";
    toolsData.forEach(tool => {
        html += `
        <div class="tool-card" onclick="openToolPage('${tool.page}')">
            <div class="tool-icon-wrapper" style="background: ${tool.color}20; color: ${tool.color};">
                <span class="material-symbols-rounded">${tool.iconCode}</span>
            </div>
            <div class="tool-title">${tool.title}</div>
        </div>
        `;
    });
    
    toolsGrid.innerHTML = html;
}

function openToolPage(page) {
    window.location.href = page;
}

// ============ THEME ============
function initTheme() {
    const savedTheme = localStorage.getItem("pdfTheme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    let theme = "light";
    
    if (savedTheme === "dark" || (savedTheme === "device" && prefersDark)) {
        theme = "dark";
    } else if (savedTheme === "light") {
        theme = "light";
    } else if (savedTheme === "device" && !prefersDark) {
        theme = "light";
    }
    
    document.documentElement.setAttribute("data-theme", theme);
}

function setThemePreference(theme) {
    localStorage.setItem("pdfTheme", theme);
    themeOptions.forEach(opt => opt.classList.remove("active"));
    document.querySelector(`.theme-option[data-theme-val="${theme}"]`).classList.add("active");
    initTheme();
    saveToCache();
    loadData();
}

// ============ DATA YÜKLEME ============
function loadData() {
    const allFiles = [...devicePDFs, ...importedFiles];
    
    recentFiles = allFiles
        .filter(f => f.lastOpened)
        .sort((a, b) => new Date(b.lastOpened) - new Date(a.lastOpened))
        .slice(0, 20);
    
    favoriteFiles = allFiles.filter(f => f.isFavorite);
    
    renderList("recentList", recentFiles);
    renderList("deviceList", allFiles);
    renderList("favoritesList", favoriteFiles);
    
    saveToCache();
}

function renderList(listId, files) {
    const listElement = document.getElementById(listId);
    if (!listElement) return;
    
    if (files.length === 0) {
        let message = "Henüz dosya yok.";
        if (listId === "recentList") message = "Henüz açılmış dosya yok.";
        if (listId === "favoritesList") message = "Henüz favori dosya yok.";
        
        listElement.innerHTML = `
        <div class="empty-state">
            <div class="empty-icon material-symbols-rounded">folder_open</div>
            <p>${message}</p>
        </div>`;
    } else {
        let html = "";
        files.forEach(file => {
            html += createCard(file.name, file.size, file.date, file.isFavorite, file.id);
        });
        listElement.innerHTML = html;
        attachLongPressEvents();
    }
}

function createCard(name, size, date, isFavorite, id) {
    const displayName = name.length > 30 ? name.substring(0, 30) + "..." : name;
    const theme = document.documentElement.getAttribute("data-theme");
    const pdfColor = theme === "dark" ? "var(--pdf-color-text)" : "#E53935";
    const fillValue = isFavorite ? 1 : 0;
    
    return `
    <div class="card" 
        data-name="${name}" 
        data-size="${size}" 
        data-date="${date}"
        data-favorite="${isFavorite}"
        data-id="${id}"
        onclick="handleCardClick(this, '${name}', ${id})">
        
        <div class="selection-checkbox" onclick="event.stopPropagation(); toggleCardSelection(${id})"></div>
        
        <div class="card-icon-svg-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 64 64">
                <rect x="0" y="0" width="64" height="64" rx="10" fill="${theme === 'dark' ? 'var(--pdf-color-bg)' : '#E53935'}"/>
                <path d="M18 12h22l10 10v30a4 4 0 0 1-4 4H18a4 4 0 0 1-4-4V16a4 4 0 0 1 4-4z" fill="#FFFFFF"/>
                <polygon points="40,12 50,22 40,22" fill="#F0F0F0"/>
                <rect x="22" y="24" width="18" height="3" rx="1.5" fill="${pdfColor}"/>
                <rect x="22" y="30" width="20" height="3" rx="1.5" fill="${pdfColor}"/>
                <rect x="22" y="36" width="20" height="3" rx="1.5" fill="${pdfColor}"/>
                <text x="50%" y="52" text-anchor="middle" font-family="Segoe UI, Roboto, Arial, sans-serif" font-weight="700" font-size="14" fill="${pdfColor}">PDF</text>
            </svg>
        </div>
        
        <div class="card-details">
            <h3 class="card-title">${displayName}</h3>
            <div class="card-meta">
                <span class="font-semibold">${size}</span> 
                <span>•</span> 
                <span>${date}</span>
            </div>
        </div>
        
        <div class="card-actions">
            <button class="icon-button favorite-btn" 
                data-fill="${fillValue}"
                onclick="event.stopPropagation(); toggleFavorite(this, ${id})">
                <span class="material-symbols-rounded" style="font-variation-settings: 'FILL' ${fillValue}, 'wght' 500, 'GRAD' 0, 'opsz' 24;">star</span>
            </button>
            <button class="icon-button more-btn" 
                onclick="event.stopPropagation(); openContextMenu('${name}', '${size}', '${date}', ${id})">
                <span class="material-symbols-rounded">more_vert</span>
            </button>
        </div>
    </div>`;
}

// ============ FAB ACTIONS ============
function handleFabAction(action) {
    if (action === "ocr") {
        window.location.href = "orc.html";
    } else if (action === "import") {
        // Android file picker'ı aç
        if (typeof Android !== 'undefined' && Android.openFilePicker) {
            Android.openFilePicker();
        } else {
            // Fallback: HTML file input
            pdfFileInput.click();
        }
    }
    fabMenu.classList.remove("show");
}

// File input handler
pdfFileInput.addEventListener("change", function(event) {
    const files = event.target.files;
    if (files && files.length > 0) {
        const file = files[0];
        const today = new Date();
        const dateStr = `${String(today.getDate()).padStart(2, '0')}.${String(today.getMonth() + 1).padStart(2, '0')}.${today.getFullYear()}`;
        
        const reader = new FileReader();
        reader.onload = function() {
            const newFile = {
                name: file.name,
                size: formatBytes(file.size),
                date: dateStr,
                isFavorite: false,
                id: Date.now(),
                base64: reader.result,
                lastOpened: null
            };
            
            importedFiles.unshift(newFile);
            log(`${newFile.name} başarıyla içe aktarıldı.`);
            
            if (currentNav !== "home") {
                switchNav("home");
            }
            switchTab("device", true);
            loadData();
            saveToCache();
            pdfFileInput.value = "";
        };
        reader.readAsDataURL(file);
    }
});

function formatBytes(bytes, decimals = 1) {
    if (!+bytes) return "0 Bytes";
    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
}

// ============ SELECTION MODE ============
function enterSelectionMode() {
    isSelectionMode = true;
    document.body.classList.add("selection-mode");
    updateSelectionCount();
}

function exitSelectionMode() {
    isSelectionMode = false;
    document.body.classList.remove("selection-mode");
    selectedCards.clear();
    document.querySelectorAll(".selection-checkbox").forEach(cb => cb.classList.remove("selected"));
    document.querySelectorAll(".card").forEach(card => card.classList.remove("selected"));
}

function toggleCardSelection(id) {
    if (!isSelectionMode) enterSelectionMode();
    
    const card = document.querySelector(`.card[data-id="${id}"]`);
    const checkbox = card.querySelector(".selection-checkbox");
    
    if (selectedCards.has(id)) {
        selectedCards.delete(id);
        checkbox.classList.remove("selected");
        card.classList.remove("selected");
    } else {
        selectedCards.add(id);
        checkbox.classList.add("selected");
        card.classList.add("selected");
    }
    
    updateSelectionCount();
    
    if (selectedCards.size === 0) {
        exitSelectionMode();
    }
}

function selectAllCards() {
    document.querySelectorAll(".card:not(.hidden)").forEach(card => {
        const id = parseInt(card.dataset.id);
        selectedCards.add(id);
        card.querySelector(".selection-checkbox").classList.add("selected");
        card.classList.add("selected");
    });
    updateSelectionCount();
}

function deselectAllCards() {
    selectedCards.clear();
    document.querySelectorAll(".selection-checkbox").forEach(cb => cb.classList.remove("selected"));
    document.querySelectorAll(".card").forEach(card => card.classList.remove("selected"));
    updateSelectionCount();
}

// ============ PAYLAŞMA FONKSİYONLARI - DÜZELTİLMİŞ ============
function shareSelectedCards() {
    if (selectedCards.size === 0) {
        log("Lütfen paylaşmak için öğe seçin.");
        return;
    }
    
    const filesToShare = [];
    selectedCards.forEach(id => {
        let file = importedFiles.find(f => f.id === id);
        if (!file) file = devicePDFs.find(f => f.id === id);
        if (file) filesToShare.push(file);
    });
    
    if (filesToShare.length === 0) {
        log("Paylaşılacak dosya bulunamadı.");
        return;
    }
    
    if (filesToShare.length === 1) {
        const file = filesToShare[0];
        if (typeof Android !== 'undefined' && Android.shareFile) {
            // DOĞRUDAN PAYLAŞ - PATHS OLARAK GÖNDER
            Android.shareFile(file.path || file.name);
        } else {
            log("Android paylaşım API'si bulunamadı");
        }
    } else {
        // Çoklu paylaşım için path'leri birleştir
        const paths = filesToShare.map(f => f.path || f.name).join("||");
        if (typeof Android !== 'undefined' && Android.shareFiles) {
            Android.shareFiles(paths);
        } else {
            log("Android çoklu paylaşım API'si bulunamadı");
        }
    }
}

function shareSingleFile(cardId, fileName) {
    log(`Tek dosya paylaşılıyor: ${fileName}`);
    
    let file = importedFiles.find(f => f.id === cardId);
    if (!file) file = devicePDFs.find(f => f.id === cardId);
    
    if (file) {
        if (typeof Android !== 'undefined' && Android.shareFile) {
            // DOĞRUDAN PAYLAŞ
            Android.shareFile(file.path);
        } else {
            log("Android paylaşım API'si bulunamadı");
        }
    } else {
        log("Dosya bulunamadı.");
    }
}

// ============ YAZDIRMA FONKSİYONLARI - DÜZELTİLMİŞ ============
function printSelectedCards() {
    if (selectedCards.size === 0) {
        log("Lütfen yazdırmak için öğe seçin.");
        return;
    }
    
    const filesToPrint = [];
    selectedCards.forEach(id => {
        let file = importedFiles.find(f => f.id === id);
        if (!file) file = devicePDFs.find(f => f.id === id);
        if (file) filesToPrint.push(file);
    });
    
    if (filesToPrint.length === 0) {
        log("Yazdırılacak dosya bulunamadı.");
        return;
    }
    
    // Sırayla yazdır
    filesToPrint.forEach((file, index) => {
        setTimeout(() => {
            printSingleFileDirectly(file);
        }, index * 500);
    });
}

function printSingleFile(id) {
    let file = importedFiles.find(f => f.id === id);
    if (!file) file = devicePDFs.find(f => f.id === id);
    
    if (file) {
        printSingleFileDirectly(file);
    } else {
        log("Dosya bulunamadı.");
    }
}

function printSingleFileDirectly(file) {
    log(`Yazdırılıyor: ${file.name}`);
    
    if (typeof Android !== 'undefined' && Android.printPDF) {
        // DOĞRUDAN YAZDIR
        Android.printPDF(file.path);
    } else {
        log("Android yazdırma API'si bulunamadı");
    }
}

// ============ SİLME ============
function deleteSelectedCards() {
    if (selectedCards.size === 0) {
        log("Lütfen silmek için öğe seçin.");
        return;
    }
    
    // CONFIRM YOK - DOĞRUDAN SİL
    selectedCards.forEach(id => {
        importedFiles = importedFiles.filter(f => f.id !== id);
        const index = devicePDFs.findIndex(f => f.id === id);
        if (index > -1) {
            const file = devicePDFs[index];
            if (typeof Android !== 'undefined' && Android.deleteFile && file.path) {
                Android.deleteFile(file.path);
            }
            devicePDFs.splice(index, 1);
        }
    });
    
    log(`${selectedCards.size} öğe silindi.`);
    exitSelectionMode();
    loadData();
    saveToCache();
}

function updateSelectionCount() {
    selectionCount.textContent = `${selectedCards.size} öğe seçildi`;
}

// ============ FAVORITE ============
function toggleFavorite(button, id) {
    if (isSelectionMode) {
        toggleCardSelection(id);
        return;
    }
    
    const icon = button.querySelector(".material-symbols-rounded");
    const card = button.closest(".card");
    let isFavorite = card.dataset.favorite === "true";
    
    isFavorite = !isFavorite;
    card.dataset.favorite = isFavorite;
    
    const fillValue = isFavorite ? 1 : 0;
    icon.style.fontVariationSettings = `'FILL' ${fillValue}, 'wght' 500, 'GRAD' 0, 'opsz' 24`;
    
    let importedIndex = importedFiles.findIndex(f => f.id === id);
    if (importedIndex > -1) {
        importedFiles[importedIndex].isFavorite = isFavorite;
    }
    
    let deviceIndex = devicePDFs.findIndex(f => f.id === id);
    if (deviceIndex > -1) {
        devicePDFs[deviceIndex].isFavorite = isFavorite;
    }
    
    loadData();
    saveToCache();
}

// ============ LONG PRESS ============
let longPressTimer;
let isLongPress = false;

function attachLongPressEvents() {
    document.querySelectorAll(".card").forEach(card => {
        card.addEventListener("touchstart", function(e) {
            if (e.target.closest(".icon-button")) {
                clearTimeout(longPressTimer);
                return;
            }
            
            isLongPress = false;
            longPressTimer = setTimeout(() => {
                isLongPress = true;
                if (navigator.vibrate) navigator.vibrate(50);
                toggleCardSelection(parseInt(card.dataset.id));
            }, 500);
        }, { passive: true });
        
        card.addEventListener("touchend", () => {
            clearTimeout(longPressTimer);
        });
        
        card.addEventListener("touchmove", () => {
            clearTimeout(longPressTimer);
        });
    });
}

// ============ CARD CLICK ============
function handleCardClick(cardElement, name, id) {
    if (isSelectionMode) {
        toggleCardSelection(id);
    } else if (!isLongPress) {
        let file = importedFiles.find(f => f.id === id);
        if (!file) file = devicePDFs.find(f => f.id === id);
        
        if (file) {
            file.lastOpened = new Date().toISOString();
            loadData();
            saveToCache();
            openPDF(file, name);
        }
    }
}

function openPDF(file, name) {
    if (file.base64) {
        const url = "viewer.html?base64=" + encodeURIComponent(file.base64) + "&name=" + encodeURIComponent(name) + "&id=" + file.id;
        window.location.href = url;
    } else if (file.path) {
        const url = "viewer.html?file=" + encodeURIComponent(file.path) + "&name=" + encodeURIComponent(name) + "&id=" + file.id;
        window.location.href = url;
    } else {
        log("Dosya verisi bulunamadı!");
    }
}

// ============ CONTEXT MENU ============
function openContextMenu(name, size, date, cardId) {
    if (isSelectionMode) {
        toggleCardSelection(cardId);
        return;
    }
    
    currentContextFile = {
        name: name,
        size: size,
        date: date,
        cardId: cardId
    };
    
    contextTitle.textContent = name;
    contextMeta.textContent = `${size} • ${date}`;
    contextOverlay.classList.add("show");
    contextSheet.classList.add("show");
}

function closeContextMenu() {
    contextOverlay.classList.remove("show");
    contextSheet.classList.remove("show");
}

function handleContextAction(action) {
    closeContextMenu();
    
    setTimeout(() => {
        switch (action) {
            case "rename":
                openRenameDialog(currentContextFile.cardId, currentContextFile.name);
                break;
            case "share":
                shareSingleFile(currentContextFile.cardId, currentContextFile.name);
                break;
            case "print":
                printSingleFile(currentContextFile.cardId, currentContextFile.name);
                break;
            case "delete":
                deleteSingleFile(currentContextFile.cardId, currentContextFile.name);
                break;
        }
    }, 300);
}

// ============ RENAME ============
let currentRenameFile = null;

function openRenameDialog(cardId, oldName) {
    currentRenameFile = {
        cardId: cardId,
        oldName: oldName
    };
    
    renameOldName.textContent = `Eski ad: ${oldName}`;
    const nameWithoutExt = oldName.replace(/\.pdf$/i, "");
    newFileNameInput.value = nameWithoutExt;
    newFileNameInput.focus();
    renameDialog.classList.add("show");
}

function closeRenameDialog() {
    renameDialog.classList.remove("show");
    currentRenameFile = null;
}

function confirmRenameFile() {
    if (!currentRenameFile) return;
    
    const newName = newFileNameInput.value.trim();
    if (!newName) {
        log("Lütfen bir dosya adı girin.");
        return;
    }
    
    const finalName = newName.endsWith(".pdf") ? newName : newName + ".pdf";
    
    if (finalName !== currentRenameFile.oldName) {
        renameFile(currentRenameFile.cardId, currentRenameFile.oldName, finalName);
        closeRenameDialog();
    } else {
        log("Yeni ad eski adla aynı.");
    }
}

function renameFile(cardId, oldName, newName) {
    let importedIndex = importedFiles.findIndex(f => f.id === cardId);
    if (importedIndex > -1) {
        importedFiles[importedIndex].name = newName;
    }
    
    let deviceIndex = devicePDFs.findIndex(f => f.id === cardId);
    if (deviceIndex > -1) {
        const file = devicePDFs[deviceIndex];
        if (typeof Android !== 'undefined' && Android.renameFile && file.path) {
            const result = Android.renameFile(file.path, newName);
            if (result && result !== "ERROR") {
                devicePDFs[deviceIndex].path = result;
                devicePDFs[deviceIndex].name = newName;
            } else {
                devicePDFs[deviceIndex].name = newName;
            }
        } else {
            devicePDFs[deviceIndex].name = newName;
        }
    }
    
    loadData();
    saveToCache();
    log("Dosya adı güncellendi.");
}

// ============ DELETE SINGLE ============
function deleteSingleFile(cardId, fileName) {
    // CONFIRM YOK - DOĞRUDAN SİL
    importedFiles = importedFiles.filter(f => f.id !== cardId);
    const index = devicePDFs.findIndex(f => f.id === cardId);
    
    if (index > -1) {
        const file = devicePDFs[index];
        if (typeof Android !== 'undefined' && Android.deleteFile && file.path) {
            Android.deleteFile(file.path);
        }
        devicePDFs.splice(index, 1);
    }
    
    loadData();
    saveToCache();
    log("Dosya silindi.");
}

// ============ SEARCH ============
function openSearch() {
    searchOverlay.classList.add("active");
    searchInput.focus();
    performSearch();
}

function closeSearch() {
    searchOverlay.classList.remove("active");
    searchInput.value = "";
    clearSearch();
}

function clearSearch() {
    searchInput.value = "";
    performSearch();
}

function performSearch() {
    const query = searchInput.value.toLowerCase().trim();
    const allFiles = [...devicePDFs, ...importedFiles];
    
    if (query === "") {
        searchResultCount.textContent = "Arama yapmak için bir şeyler yazın...";
        searchResults.innerHTML = `
        <div class="empty-state">
            <div class="empty-icon material-symbols-rounded">search</div>
            <p>Arama yapmak için yukarıya bir şeyler yazın</p>
        </div>`;
        return;
    }
    
    const results = allFiles.filter(file => {
        const name = file.name.toLowerCase();
        const date = file.date.toLowerCase();
        const size = file.size.toLowerCase();
        
        return name.includes(query) || date.includes(query) || size.includes(query);
    });
    
    searchResultCount.textContent = `${results.length} sonuç bulundu`;
    
    if (results.length === 0) {
        searchResults.innerHTML = `
        <div class="empty-state">
            <div class="empty-icon material-symbols-rounded">search_off</div>
            <p>"${query}" için sonuç bulunamadı</p>
        </div>`;
    } else {
        let html = "";
        results.forEach(file => {
            const displayName = file.name.length > 30 ? file.name.substring(0, 30) + "..." : file.name;
            html += `
            <div class="card" onclick="openPDF(${JSON.stringify(file)}, '${file.name}')">
                <div class="card-icon-svg-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 64 64">
                        <rect x="0" y="0" width="64" height="64" rx="10" fill="#E53935"/>
                        <path d="M18 12h22l10 10v30a4 4 0 0 1-4 4H18a4 4 0 0 1-4-4V16a4 4 0 0 1 4-4z" fill="#FFFFFF"/>
                        <polygon points="40,12 50,22 40,22" fill="#F0F0F0"/>
                        <rect x="22" y="24" width="18" height="3" rx="1.5" fill="#E53935"/>
                        <rect x="22" y="30" width="20" height="3" rx="1.5" fill="#E53935"/>
                        <rect x="22" y="36" width="20" height="3" rx="1.5" fill="#E53935"/>
                        <text x="50%" y="52" text-anchor="middle" font-family="Segoe UI, Roboto, Arial, sans-serif" font-weight="700" font-size="14" fill="#E53935">PDF</text>
                    </svg>
                </div>
                <div class="card-details">
                    <h3 class="card-title">${displayName}</h3>
                    <div class="card-meta">
                        <span class="font-semibold">${file.size}</span> 
                        <span>•</span> 
                        <span>${file.date}</span>
                    </div>
                </div>
            </div>`;
        });
        searchResults.innerHTML = html;
    }
}

// ============ SCROLL HANDLING ============
function handleScroll(event) {
    if (searchOverlay.classList.contains("active") || 
        document.body.classList.contains("selection-mode") || 
        !document.body.classList.contains("is-home")) {
        return;
    }
    
    const panel = event.target;
    if (!panel.classList.contains("active")) return;
    
    const scrollTop = panel.scrollTop;
    const scrollDelta = scrollTop - lastScrollY;
    
    if (scrollDelta > 0 && scrollTop > 50 && !isHeaderHidden) {
        hideHeader();
    } else if ((scrollDelta < -10 && isHeaderHidden) || (scrollTop <= 10 && isHeaderHidden)) {
        showHeader();
    }
    
    lastScrollY = scrollTop;
}

function hideHeader() {
    isHeaderHidden = true;
    topBar.classList.add("hidden");
    document.querySelectorAll(".content-panel.active").forEach(panel => {
        panel.style.paddingTop = "var(--h-tabs)";
    });
    mainContent.style.paddingTop = "var(--h-tabs)";
}

function showHeader() {
    isHeaderHidden = false;
    topBar.classList.remove("hidden");
    document.querySelectorAll(".content-panel.active").forEach(panel => {
        panel.style.paddingTop = "var(--top-bar-total)";
    });
    mainContent.style.paddingTop = "var(--top-bar-total)";
}

// ============ EVENT LISTENERS ============
function attachEvents() {
    contextOverlay.addEventListener("click", closeContextMenu);
    
    searchBtn.addEventListener("click", openSearch);
    closeSearchBtn.addEventListener("click", closeSearch);
    searchInput.addEventListener("input", performSearch);
    
    panels.forEach(panel => {
        panel.addEventListener("scroll", event => {
            if (searchOverlay.classList.contains("active") || 
                document.body.classList.contains("selection-mode") || 
                !document.body.classList.contains("is-home")) {
                return;
            }
            handleScroll(event);
        });
        
        panel.addEventListener("touchstart", event => {
            if (!searchOverlay.classList.contains("active") && 
                document.body.classList.contains("is-home") && 
                panel.classList.contains("active")) {
                startX = event.touches[0].clientX;
                startY = event.touches[0].clientY;
                isSwiping = false;
                isVerticalScroll = false;
            }
        }, { passive: false });
        
        panel.addEventListener("touchmove", event => {
            if (searchOverlay.classList.contains("active") || 
                !document.body.classList.contains("is-home")) {
                return;
            }
            if (!panel.classList.contains("active")) return;
            
            const currentX = event.touches[0].clientX;
            const currentY = event.touches[0].clientY;
            const diffX = currentX - startX;
            const diffY = currentY - startY;
            
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) {
                event.preventDefault();
                isSwiping = true;
                isVerticalScroll = false;
            } else if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > 10) {
                isSwiping = false;
                isVerticalScroll = true;
            }
        }, { passive: false });
        
        panel.addEventListener("touchend", event => {
            if (searchOverlay.classList.contains("active") || 
                !document.body.classList.contains("is-home")) {
                return;
            }
            if (!panel.classList.contains("active")) return;
            
            const diffX = event.changedTouches[0].clientX - startX;
            if (isSwiping && Math.abs(diffX) > 50) {
                changeTab(diffX < 0 ? 1 : -1);
            }
            isSwiping = false;
            isVerticalScroll = false;
        });
    });
    
    tabs.forEach(tab => {
        tab.addEventListener("click", () => switchTab(tab.dataset.tab, true));
    });
    
    navItems.forEach(navItem => {
        navItem.addEventListener("click", () => switchNav(navItem.dataset.nav));
    });
    
    fabButton.addEventListener("click", event => {
        event.stopPropagation();
        fabMenu.classList.toggle("show");
    });
    
    document.addEventListener("click", () => {
        fabMenu.classList.remove("show");
    });
    
    document.getElementById("menuBtn").addEventListener("click", () => {
        drawer.classList.add("open");
        overlay.classList.add("show");
    });
    
    overlay.addEventListener("click", () => {
        drawer.classList.remove("open");
        overlay.classList.remove("show");
    });
    
    drawerItems.forEach(item => {
        item.addEventListener("click", () => {
            const accordionId = `accordion-${item.dataset.accordion}`;
            const content = document.getElementById(accordionId);
            
            document.querySelectorAll(".drawer-accordion-content.open").forEach(acc => {
                if (acc !== content) acc.classList.remove("open");
            });
            
            content.classList.toggle("open");
        });
    });
    
    settingsTabs.forEach(tab => {
        tab.addEventListener("click", () => {
            const tabId = tab.dataset.tab;
            
            settingsTabs.forEach(t => t.classList.remove("active"));
            document.querySelectorAll(".setting-panel").forEach(p => p.classList.remove("active"));
            
            tab.classList.add("active");
            document.querySelector(`.setting-panel[data-panel="${tabId}"]`).classList.add("active");
        });
    });
}

// ============ TAB SWITCHING ============
function switchTab(tabId, resetScroll = false) {
    tabs.forEach(tab => {
        tab.classList.toggle("active", tab.dataset.tab === tabId);
    });
    
    ["recentPanel", "devicePanel", "favoritesPanel"].forEach(panelId => {
        const panel = document.getElementById(panelId);
        if (panel) {
            panel.classList.toggle("active", panelId === `${tabId}Panel`);
            if (panelId === `${tabId}Panel` && resetScroll) {
                panel.scrollTop = 0;
                showHeader();
                lastScrollY = 0;
            }
        }
    });
    
    if (tabId === "device") {
        setTimeout(() => {
            checkPermissionOnResume();
        }, 300);
    }
}

function changeTab(direction) {
    const activeTab = document.querySelector(".tab.active").dataset.tab;
    const currentIndex = tabOrder.indexOf(activeTab);
    const newIndex = currentIndex + direction;
    
    if (newIndex >= 0 && newIndex < tabOrder.length) {
        switchTab(tabOrder[newIndex], false);
    }
}

// ============ NAV SWITCHING ============
function switchNav(navId) {
    if (isSelectionMode) exitSelectionMode();
    
    navItems.forEach(item => {
        item.classList.toggle("active", item.dataset.nav === navId);
    });
    
    currentNav = navId;
    
    if (navId === "home") {
        document.body.classList.add("is-home");
        document.body.classList.remove("is-tools", "is-files");
        panels.forEach(panel => panel.classList.remove("active"));
        showHeader();
        lastScrollY = 0;
        fabButton.style.display = "flex";
        mainContent.style.paddingTop = "var(--top-bar-total)";
        switchTab("recent", true);
    } else {
        document.body.classList.remove("is-home");
        if (navId === "tools") {
            document.body.classList.add("is-tools");
            document.body.classList.remove("is-files");
        } else if (navId === "files") {
            document.body.classList.add("is-files");
            document.body.classList.remove("is-tools");
        }
        
        panels.forEach(panel => panel.classList.remove("active"));
        showHeader();
        lastScrollY = 0;
        fabButton.style.display = "none";
        mainContent.style.paddingTop = "calc(var(--h-header) + 16px)";
        
        const panel = document.getElementById(`${navId}Panel`);
        if (panel) {
            panel.classList.add("active");
            panel.scrollTop = 0;
        }
    }
}

// ============ FILE SOURCE HANDLING ============
function handleFileSource(source) {
    if (source === "device") {
        switchNav("home");
        switchTab("device", true);
    } else if (source === "browse_more") {
        log("Cihazınızın dosya yöneticisi açılıyor...");
    } else {
        log(`${source.toUpperCase()} kaynağına bağlanılıyor...`);
    }
}

// ============ HELP EMAIL ============
function sendHelpEmail(event) {
    event.preventDefault();
    
    const email = document.getElementById("helpEmail").value;
    const subject = document.getElementById("helpSubject").value;
    const issue = document.getElementById("helpIssue").value;
    
    const mailtoLink = `mailto:devsoftawaremail@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent("Gönderen: " + email + "\n\nSorun:\n" + issue)}`;
    
    window.location.href = mailtoLink;
    document.querySelector(".help-form").reset();
}

// ============ INITIALIZATION ============
document.addEventListener("DOMContentLoaded", () => {
    loadFromCache();
    initTheme();
    loadData();
    loadTools();
    attachEvents();
    
    document.querySelector(".setting-tab").classList.add("active");
    document.querySelector(".setting-panel").classList.add("active");
    
    const savedTheme = localStorage.getItem("pdfTheme") || 
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
    
    let themeToSelect = savedTheme === "dark" ? "dark" : savedTheme === "light" ? "light" : "device";
    document.querySelector(`.theme-option[data-theme-val="${themeToSelect}"]`).classList.add("active");
    
    document.body.classList.add("is-home");
    
    setTimeout(() => {
        checkInitialPermission();
    }, 1000);
    
    const deviceTab = document.querySelector('.tab[data-tab="device"]');
    if (deviceTab) {
        deviceTab.addEventListener("click", () => {
            setTimeout(() => {
                checkPermissionOnResume();
            }, 300);
        });
    }
    
    setInterval(saveToCache, 30000);
});

// ============ GLOBAL FUNCTIONS ============
window.setThemePreference = setThemePreference;
window.sendHelpEmail = sendHelpEmail;
window.handleFileSource = handleFileSource;
window.handleFabAction = handleFabAction;
window.openSearch = openSearch;
window.closeSearch = closeSearch;
window.clearSearch = clearSearch;
window.performSearch = performSearch;
window.openContextMenu = openContextMenu;
window.handleContextAction = handleContextAction;
window.handleCardClick = handleCardClick;
window.openPDF = openPDF;
window.toggleFavorite = toggleFavorite;
window.enterSelectionMode = enterSelectionMode;
window.exitSelectionMode = exitSelectionMode;
window.toggleCardSelection = toggleCardSelection;
window.selectAllCards = selectAllCards;
window.deselectAllCards = deselectAllCards;
window.deleteSelectedCards = deleteSelectedCards;
window.shareSelectedCards = shareSelectedCards;
window.printSelectedCards = printSelectedCards;
window.printSingleFile = printSingleFile;
window.openToolPage = openToolPage;
window.openAndroidPermissionSettings = openAndroidPermissionSettings;
window.onPermissionGranted = onPermissionGranted;
window.onPermissionDenied = onPermissionDenied;
window.scanDeviceForPDFs = scanDeviceForPDFs;
window.checkPermissionOnResume = checkPermissionOnResume;
window.openRenameDialog = openRenameDialog;
window.closeRenameDialog = closeRenameDialog;
window.confirmRenameFile = confirmRenameFile;
window.log = log;
</script>
</body>
</html>

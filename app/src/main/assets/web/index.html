<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>PDF Reader | Dev Software</title>
  
  <style>
    /* Material Icons */
    .material-icons {
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-smoothing: antialiased;
    }
    
    /* --- VARIABLES --- */
    :root {
      --background: #f5f5f5;
      --surface: #ffffff;
      --primary: #E53935;
      --secondary: #B71C1C;
      --text-primary: #333333;
      --text-secondary: #666666;
      --border: #dddddd;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
      
      --header-height: 56px;
      --tabs-height: 48px;
      --bottom-nav-height: 56px;
    }

    /* --- BASE STYLES --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { 
      height: 100%; 
      font-family: 'Roboto', sans-serif; 
      background-color: var(--background); 
      color: var(--text-primary); 
      overflow: hidden; 
    }
    body { display: flex; flex-direction: column; }
    
    /* --- HEADER --- */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: var(--header-height);
      background: var(--surface);
      z-index: 100;
      box-shadow: var(--shadow);
      border-bottom: 1px solid var(--border);
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      height: 100%;
    }
    
    .logo-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      overflow: hidden;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }
    
    .app-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
    }
    
    /* --- TABS --- */
    .tabs {
      display: flex;
      height: var(--tabs-height);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      z-index: 99;
    }
    
    .tab {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 500;
      gap: 2px;
      cursor: pointer;
    }
    
    .tab.active {
      color: var(--primary);
      position: relative;
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 25%;
      right: 25%;
      height: 3px;
      background: var(--primary);
      border-radius: 3px 3px 0 0;
    }
    
    /* --- MAIN CONTENT --- */
    .main-content {
      flex: 1;
      margin-top: calc(var(--header-height) + var(--tabs-height));
      margin-bottom: var(--bottom-nav-height);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .content-panel {
      display: none;
      padding: 16px;
    }
    
    .content-panel.active {
      display: block;
    }
    
    /* --- PDF CARDS --- */
    .pdf-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .pdf-card {
      background: var(--surface);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid var(--border);
      cursor: pointer;
    }
    
    .pdf-card:active {
      background: rgba(0,0,0,0.05);
      transform: scale(0.98);
    }
    
    .pdf-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
    
    .pdf-info {
      flex: 1;
    }
    
    .pdf-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .pdf-meta {
      font-size: 11px;
      color: var(--text-secondary);
      display: flex;
      gap: 8px;
    }
    
    .pdf-actions {
      display: flex;
      gap: 4px;
    }
    
    /* --- BOTTOM NAV --- */
    .bottom-nav {
      height: var(--bottom-nav-height);
      background: var(--surface);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
    }
    
    .nav-item.active {
      color: var(--primary);
    }
    
    /* --- FAB --- */
    .fab-container {
      position: fixed;
      bottom: calc(var(--bottom-nav-height) + 16px);
      right: 16px;
      z-index: 101;
    }
    
    .fab {
      width: 56px;
      height: 56px;
      border-radius: 28px;
      background: var(--primary);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      cursor: pointer;
    }
    
    /* --- EMPTY STATE --- */
    .empty-state {
      padding: 40px 20px;
      text-align: center;
      color: var(--text-secondary);
    }
    
    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* --- PERMISSION BANNER --- */
    .permission-banner {
      padding: 20px;
      text-align: center;
      background: var(--surface);
      border-radius: 12px;
      margin: 20px;
      border: 1px solid var(--border);
    }
    
    .permission-banner h3 {
      font-size: 16px;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .permission-banner p {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }
    
    .permission-banner button {
      padding: 12px 24px;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* --- BUTTONS --- */
    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
    
    .btn-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      border: none;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .btn-icon:active {
      background: rgba(0,0,0,0.1);
    }
    
    /* --- MOBILE --- */
    @media (max-width: 768px) {
      .header-content {
        padding: 0 12px;
      }
      
      .content-panel {
        padding: 12px;
      }
      
      .pdf-card {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Hidden file input -->
  <input type="file" id="fileInput" accept=".pdf" style="display:none">

  <!-- HEADER -->
  <div class="header">
    <div class="header-content">
      <div class="logo-title">
        <div class="logo">PDF</div>
        <div class="app-title">PDF Reader</div>
      </div>
      
      <div class="header-actions">
        <button class="btn-icon" id="searchBtn">
          <span class="material-icons">search</span>
        </button>
        <button class="btn-icon" id="menuBtn">
          <span class="material-icons">menu</span>
        </button>
      </div>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <div class="tab active" data-tab="recent">
      <span class="material-icons">history</span>
      <span>Recent</span>
    </div>
    <div class="tab" data-tab="device">
      <span class="material-icons">folder</span>
      <span>Device</span>
    </div>
    <div class="tab" data-tab="favorites">
      <span class="material-icons">star</span>
      <span>Favorites</span>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="main-content" id="mainContent">
    <!-- RECENT FILES -->
    <div class="content-panel active" id="recentPanel">
      <div class="pdf-grid" id="recentList">
        <!-- Recent PDFs will be loaded here -->
      </div>
    </div>
    
    <!-- DEVICE FILES -->
    <div class="content-panel" id="devicePanel">
      <div class="permission-banner" id="permissionContainer" style="display:none;">
        <h3>Permission Required</h3>
        <p>Need permission to access PDF files on your device</p>
        <button onclick="requestPermission()">Grant Permission</button>
      </div>
      
      <div class="pdf-grid" id="deviceList">
        <!-- Device PDFs will be loaded here -->
      </div>
    </div>
    
    <!-- FAVORITES -->
    <div class="content-panel" id="favoritesPanel">
      <div class="pdf-grid" id="favoritesList">
        <!-- Favorite PDFs will be loaded here -->
      </div>
    </div>
  </main>

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <div class="nav-item active" data-nav="home">
      <span class="material-icons">home</span>
      <span>Home</span>
    </div>
    <div class="nav-item" data-nav="tools">
      <span class="material-icons">build</span>
      <span>Tools</span>
    </div>
    <div class="nav-item" data-nav="files">
      <span class="material-icons">folder</span>
      <span>Files</span>
    </div>
  </nav>

  <!-- FAB -->
  <div class="fab-container">
    <button class="fab" id="fabBtn">
      <span class="material-icons">add</span>
    </button>
  </div>

  <script>
    // ==================== VARIABLES ====================
    let pdfs = []; // All PDFs from device
    let importedPDFs = []; // Imported PDFs
    let favorites = []; // Favorite PDFs
    let currentTab = 'recent';
    let currentNav = 'home';
    
    // ==================== ANDROID BRIDGE FUNCTIONS ====================
    function checkAndroidPermission() {
      if (typeof Android !== 'undefined' && Android.checkPermission) {
        return Android.checkPermission();
      }
      return false;
    }
    
    function requestPermission() {
      if (typeof Android !== 'undefined' && Android.requestPermission) {
        Android.requestPermission();
      }
    }
    
    function listPDFs() {
      if (typeof Android !== 'undefined' && Android.listPDFs) {
        return Android.listPDFs();
      }
      return "";
    }
    
    function openPDF(path) {
      if (typeof Android !== 'undefined' && Android.openPDF) {
        Android.openPDF(path);
        return true;
      }
      return false;
    }
    
    function showToast(message) {
      if (typeof Android !== 'undefined' && Android.showToast) {
        Android.showToast(message);
      } else {
        alert(message);
      }
    }
    
    // ==================== INITIALIZATION ====================
    document.addEventListener('DOMContentLoaded', function() {
      console.log("PDF Reader initialized");
      setupEventListeners();
      loadData();
      
      // Check permission on startup
      checkPermission();
    });
    
    // ==================== EVENT LISTENERS ====================
    function setupEventListeners() {
      // Tab clicks
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          switchTab(this.dataset.tab);
        });
      });
      
      // Nav clicks
      document.querySelectorAll('.nav-item').forEach(nav => {
        nav.addEventListener('click', function() {
          switchNav(this.dataset.nav);
        });
      });
      
      // Search button
      document.getElementById('searchBtn').addEventListener('click', function() {
        showToast("Search feature coming soon");
      });
      
      // Menu button
      document.getElementById('menuBtn').addEventListener('click', function() {
        showToast("Menu feature coming soon");
      });
      
      // FAB button
      document.getElementById('fabBtn').addEventListener('click', function() {
        document.getElementById('fileInput').click();
      });
      
      // File input
      document.getElementById('fileInput').addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
          importPDF(this.files[0]);
          this.value = '';
        }
      });
    }
    
    // ==================== NAVIGATION ====================
    function switchTab(tabId) {
      currentTab = tabId;
      
      // Update tabs
      document.querySelectorAll('.tab').forEach(t => {
        t.classList.toggle('active', t.dataset.tab === tabId);
      });
      
      // Update panels
      document.querySelectorAll('.content-panel').forEach(p => {
        p.classList.toggle('active', p.id === tabId + 'Panel');
      });
      
      // Load data for tab
      loadTabData();
    }
    
    function switchNav(navId) {
      currentNav = navId;
      
      // Update nav items
      document.querySelectorAll('.nav-item').forEach(n => {
        n.classList.toggle('active', n.dataset.nav === navId);
      });
      
      // Show/Hide FAB
      document.getElementById('fabBtn').style.display = 
        (navId === 'home') ? 'block' : 'none';
    }
    
    // ==================== DATA LOADING ====================
    function loadData() {
      // Load from local storage
      const savedImports = localStorage.getItem('importedPDFs');
      if (savedImports) {
        importedPDFs = JSON.parse(savedImports);
      }
      
      const savedFavorites = localStorage.getItem('favoritePDFs');
      if (savedFavorites) {
        favorites = JSON.parse(savedFavorites);
      }
      
      loadTabData();
    }
    
    function loadTabData() {
      switch(currentTab) {
        case 'recent':
          loadRecentPDFs();
          break;
        case 'device':
          loadDevicePDFs();
          break;
        case 'favorites':
          loadFavoritePDFs();
          break;
      }
    }
    
    function loadRecentPDFs() {
      const container = document.getElementById('recentList');
      const recentPDFs = [...importedPDFs].reverse().slice(0, 10);
      
      if (recentPDFs.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <span class="material-icons empty-icon">history</span>
            <div>No recent PDFs</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = recentPDFs.map(pdf => createPDFCard(pdf)).join('');
    }
    
    function loadDevicePDFs() {
      const container = document.getElementById('deviceList');
      const permissionBanner = document.getElementById('permissionContainer');
      
      // Check permission
      if (!checkAndroidPermission()) {
        permissionBanner.style.display = 'block';
        container.style.display = 'none';
        return;
      }
      
      permissionBanner.style.display = 'none';
      container.style.display = 'block';
      
      // Load PDFs from Android
      const pdfList = listPDFs();
      if (!pdfList || pdfList.trim() === "") {
        container.innerHTML = `
          <div class="empty-state">
            <span class="material-icons empty-icon">folder_open</span>
            <div>No PDFs found on device</div>
          </div>
        `;
        return;
      }
      
      const pdfPaths = pdfList.split('||').filter(p => p && p.trim().length > 0);
      const devicePDFs = pdfPaths.map((path, index) => {
        const name = path.split('/').pop();
        return {
          id: 'device_' + index,
          name: name,
          path: path,
          isFavorite: false,
          size: "~2 MB",
          date: new Date().toLocaleDateString('en-US')
        };
      });
      
      // Combine with imported PDFs
      const allPDFs = [...devicePDFs, ...importedPDFs];
      
      if (allPDFs.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <span class="material-icons empty-icon">folder_open</span>
            <div>No PDFs found</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = allPDFs.map(pdf => createPDFCard(pdf)).join('');
    }
    
    function loadFavoritePDFs() {
      const container = document.getElementById('favoritesList');
      
      if (favorites.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <span class="material-icons empty-icon">star</span>
            <div>No favorite PDFs</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = favorites.map(pdf => createPDFCard(pdf)).join('');
    }
    
    // ==================== PDF CARD CREATION ====================
    function createPDFCard(pdf) {
      const isFavorite = favorites.some(f => f.id === pdf.id);
      
      return `
        <div class="pdf-card" onclick="openPDFFile('${pdf.id}', '${pdf.path || ''}')">
          <div class="pdf-icon">PDF</div>
          <div class="pdf-info">
            <div class="pdf-name">${pdf.name}</div>
            <div class="pdf-meta">
              <span>${pdf.size}</span>
              <span>â€¢</span>
              <span>${pdf.date}</span>
            </div>
          </div>
          <div class="pdf-actions">
            <button class="btn-icon" onclick="event.stopPropagation(); toggleFavorite('${pdf.id}')">
              <span class="material-icons" style="color: ${isFavorite ? '#ffc107' : '#ccc'}">star</span>
            </button>
          </div>
        </div>
      `;
    }
    
    // ==================== PDF OPERATIONS ====================
    function importPDF(file) {
      if (file.type !== 'application/pdf') {
        showToast("Please select a PDF file");
        return;
      }
      
      const newPDF = {
        id: 'import_' + Date.now(),
        name: file.name,
        size: formatBytes(file.size),
        date: new Date().toLocaleDateString('en-US'),
        isFavorite: false,
        file: file
      };
      
      importedPDFs.push(newPDF);
      localStorage.setItem('importedPDFs', JSON.stringify(importedPDFs));
      
      showToast("PDF imported: " + file.name);
      loadTabData();
    }
    
    function openPDFFile(pdfId, path) {
      if (path) {
        // Device PDF
        if (openPDF(path)) {
          showToast("Opening PDF...");
        } else {
          showToast("Cannot open PDF");
        }
      } else {
        // Imported PDF
        showToast("Opening imported PDF...");
        // Here you would open the imported PDF file
      }
    }
    
    function toggleFavorite(pdfId) {
      // Find PDF in all sources
      let pdf = null;
      
      // Check imported PDFs
      pdf = importedPDFs.find(p => p.id === pdfId);
      
      if (!pdf) {
        // Check device PDFs (would need to be stored)
        showToast("Cannot favorite device PDFs");
        return;
      }
      
      const index = favorites.findIndex(f => f.id === pdfId);
      
      if (index === -1) {
        // Add to favorites
        favorites.push(pdf);
        showToast("Added to favorites");
      } else {
        // Remove from favorites
        favorites.splice(index, 1);
        showToast("Removed from favorites");
      }
      
      localStorage.setItem('favoritePDFs', JSON.stringify(favorites));
      loadTabData();
    }
    
    // ==================== PERMISSION CHECK ====================
    function checkPermission() {
      if (currentTab === 'device') {
        loadDevicePDFs();
      }
    }
    
    // ==================== UTILITY FUNCTIONS ====================
    function formatBytes(bytes) {
      if (!bytes) return "0 Bytes";
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }
    
    // ==================== ANDROID CALLBACKS ====================
    window.onAndroidResume = function() {
      console.log("App resumed");
      checkPermission();
    };
    
    window.androidBackPressed = function() {
      // Handle back button
      if (currentNav !== 'home') {
        switchNav('home');
        return false;
      }
      return true;
    };
    
  </script>
</body>
</html>

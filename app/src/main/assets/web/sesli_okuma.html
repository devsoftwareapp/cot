<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDF Sesli Okuma</title>
<style>
    body { font-family: Arial; margin: 0; padding: 0; }
    #toolbar {
        padding: 10px;
        background: #f0f0f0;
        display: flex;
        gap: 10px;
        justify-content: center;
        align-items: center;
        border-bottom: 1px solid #ccc;
    }
    button { padding: 10px 16px; font-size: 16px; cursor: pointer; }
    #pdfFrame {
        width: 100%;
        height: calc(100vh - 70px);
        border: none;
    }
</style>
</head>
<body>

<div id="toolbar">
    <button id="btnPDF">üìÑ PDF Se√ß</button>
    <button id="btnBack">‚èÆ</button>
    <button id="btnPlay">‚ñ∂</button>
    <button id="btnStop">‚èπ</button>
    <button id="btnNext">‚è≠</button>
</div>

<iframe id="pdfFrame"></iframe>

<script>
let pdfBase64 = null;
let currentTextIndex = 0;
let textChunks = [];
let isPlaying = false;

// PDF se√ß
document.getElementById("btnPDF").onclick = () => {
    if (Android && Android.openFilePicker) Android.openFilePicker();
};

// Android bu fonksiyonu √ßaƒüƒ±rƒ±yor
function onPdfSelectedFromAndroid(base64) {
    pdfBase64 = base64;
    loadPDFinIframe();
}

// viewer.html'i iframe i√ßine y√ºkle
function loadPDFinIframe() {
    const iframe = document.getElementById("pdfFrame");
    iframe.src = "viewer.html?base64=" + encodeURIComponent(pdfBase64);

    // viewer y√ºklendiƒüinde mesaj g√∂nder
    iframe.onload = () => {
        iframe.contentWindow.postMessage({ type: "LOAD_BASE64", data: pdfBase64 }, "*");
    };
}

// viewer.html ‚Üí sesli_okuma.html ileti≈üimi
window.addEventListener("message", (event) => {
    if (!event.data) return;

    if (event.data.type === "TEXT_EXTRACTED") {
        textChunks = event.data.text; 
        console.log("Metin alƒ±ndƒ±:", textChunks);
    }
});

// OYNAT
document.getElementById("btnPlay").onclick = () => {
    if (textChunks.length === 0) {
        alert("Metin hen√ºz y√ºklenmedi.");
        return;
    }

    isPlaying = true;
    speakChunk(currentTextIndex);
};

// DURDUR
document.getElementById("btnStop").onclick = () => {
    isPlaying = false;
    if (Android && Android.stop) Android.stop();
};

// GERƒ∞
document.getElementById("btnBack").onclick = () => {
    if (currentTextIndex > 0) currentTextIndex--;
    speakChunk(currentTextIndex);
};

// ƒ∞LERƒ∞
document.getElementById("btnNext").onclick = () => {
    if (currentTextIndex < textChunks.length - 1) currentTextIndex++;
    speakChunk(currentTextIndex);
};

// Bir b√∂l√ºm oku
function speakChunk(i) {
    if (!isPlaying) return;
    const text = textChunks[i] || "";
    if (Android && Android.speak) {
        Android.speak(text, "tr-TR", 1.0);
    }
}

// Android ‚Üí Bu fonksiyon √ßaƒüƒ±rƒ±ldƒ±ƒüƒ±nda bir chunk bitti
function onTTSDone() {
    if (!isPlaying) return;
    currentTextIndex++;
    if (currentTextIndex < textChunks.length) {
        speakChunk(currentTextIndex);
    }
}
</script>

</body>
</html>

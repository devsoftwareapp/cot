<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PDF Sesli Okuyucu</title>

<style>
body { margin: 0; padding: 0; font-family: Arial; background: #f7f7f7; }

#toolbar {
    background: #ececec;
    padding: 10px;
    display: flex;
    gap: 8px;
    justify-content: center;
    border-bottom: 1px solid #ccc;
}

button {
    padding: 10px 14px;
    font-size: 15px;
    border: none;
    background: #4a6fa5;
    color: white;
    border-radius: 6px;
}

iframe {
    width: 100%;
    height: calc(100vh - 70px);
    border: none;
}
</style>
</head>

<body>

<div id="toolbar">
    <button id="btnSelect">üìÑ PDF Se√ß</button>
    <button id="btnBack">‚èÆ</button>
    <button id="btnPlay">‚ñ∂</button>
    <button id="btnStop">‚èπ</button>
    <button id="btnNext">‚è≠</button>
</div>

<iframe id="pdfFrame"></iframe>

<script>
let pdfBase64 = null;
let textChunks = [];
let currentIndex = 0;
let isPlaying = false;

const frame = document.getElementById("pdfFrame");

// üìå PDF SE√á
document.getElementById("btnSelect").onclick = () => {
    if (Android && Android.openFilePicker) Android.openFilePicker();
};

// üìå ANDROID PDFƒ∞ TERS G√ñNDERƒ∞R (BU FONKSƒ∞YON Sƒ∞Lƒ∞NMEYECEK!)
function onPdfSelectedFromAndroid(base64) {
    pdfBase64 = base64;
    openViewerWithPDF();
}

// üìå viewer.html'i iframe i√ßinde a√ß
function openViewerWithPDF() {
    frame.src = "viewer.html";

    frame.onload = () => {
        frame.contentWindow.postMessage({
            type: "LOAD_BASE64",
            data: pdfBase64
        }, "*");
    };
}

// üìå viewer.html metin √ßƒ±karƒ±nca buraya g√∂nderir
window.addEventListener("message", (e) => {
    if (e.data.type === "TEXT_EXTRACTED") {
        textChunks = e.data.text; // her sayfa ayrƒ± chunk
        currentIndex = 0;
        console.log("Metin geldi:", textChunks);
    }
});

// üìå OYNAT
document.getElementById("btnPlay").onclick = () => {
    if (textChunks.length === 0) {
        alert("PDF metni hen√ºz y√ºklenmedi!");
        return;
    }
    isPlaying = true;
    playCurrentChunk();
};

// üìå chunk oku
function playCurrentChunk() {
    if (!isPlaying) return;
    const text = textChunks[currentIndex] || "";

    if (Android && AndroidTTS && AndroidTTS.speak) {
        AndroidTTS.speak(text, "tr-TR");
    }
}

// üìå DURDUR
document.getElementById("btnStop").onclick = () => {
    isPlaying = false;
    if (AndroidTTS.stop) AndroidTTS.stop();
};

// üìå GERƒ∞
document.getElementById("btnBack").onclick = () => {
    if (currentIndex > 0) currentIndex--;
    playCurrentChunk();
};

// üìå ƒ∞LERƒ∞
document.getElementById("btnNext").onclick = () => {
    if (currentIndex < textChunks.length - 1) currentIndex++;
    playCurrentChunk();
};

// üìå AndroidTTS ‚Üí okuma bittik√ße √ßaƒüƒ±rƒ±r
function onTTSDone() {
    if (!isPlaying) return;
    currentIndex++;
    if (currentIndex < textChunks.length) {
        playCurrentChunk();
    } else {
        isPlaying = false;
    }
}
</script>

</body>
</html>
